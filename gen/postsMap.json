[
  {
    "id": "20200526-next-portfolio",
    "title": "Qiita: Next.js でポートフォリオサイトを作成した",
    "create": "2020-05-26",
    "update": "2020-07-14",
    "tags": [
      "next",
      "react",
      "remark",
      "typescript"
    ],
    "content": "はじめにRuby + JekyllによるGihubPagesは既にあるのですが、宮崎版コロナ対策サイトでVueに触れ、勉強がてら実際にJSによるサイト作成をする事にしました。JSの現状を知るために参照した主サイト2020年 React軸で学ぶべき技術 from mizchi's blogユーザー体験を向上させるサーバーサイドレンダリングJavaScript — 歴史と利点自分大学研究でcppを利用しただけの、農学部卒。ただいま無職、転職活動中（ここ2か月は自粛でstay home作成に当たってReact とNext.js のtutorial と docs を一通りやりました。React チュートリアルNext.js チュートリアルサイト自体の目的経歴や作成したもののリンクをまとめるGithubPagesやQiita、Gistへの投稿物を一か所にまとめるMarkdonwによるページ作成つくったものGithub リポジトリthis sitelighthouse技術・要件などReact.js, Next.jsマークダウン変換remarkjs/reamrkあとでmdx-js/mdxに変更するかもシンタックスハイライトhighlight.jsUIコンポーネントMaterial-UI mui-org/material-uiダークテーマ環境vm：virtualbox + vagrantOS: Ubuntu18.04 bionicnode -v :v12.16.1yarn -v :1.22.4実作業yarn create next-appyarn create next-app next-portfolio=>? Pick a template › - Use arrow-keys. Return to submit.❯Default starter appExample from the Next.js repoExample from the Next.js repoamp類amp, amp-story, amp-first参照: ビジュアルに訴える AMP ストーリーを作成する from AMPgoogle analytics類with-google-analytics, with-google-analytics-ampaws類with-aws-amplify, with-aws-amplify-typescriptその他: api類, custome server類, preact及び多数（多すぎるので割愛参照：Github: zeit/next.js/exampleDefault starter appの場合今回はReact Next.jsの勉強も兼ねているので、defaultの方を利用した。yarn devするとdirectorypublicfavicon.ico, zeit.svgpagesindex.jspackage.jsonnode_modulesREADME.mdyarn.lock// package.json{\"name\": \"next-portfolio\",\"version\": \"0.1.0\",\"private\": true,\"scripts\": {\"dev\": \"next dev\",\"build\": \"next build\",\"start\": \"next start\"},\"dependencies\": {\"next\": \"9.3.5\",\"react\": \"16.13.1\",\"react-dom\": \"16.13.1\"}}参照React.ComponentReact.FragmentMaterial-UI 導入見た目重視でmaterial-uiを導入し、主にサイドバーのpermanent / swipeable drawerとGridに使用。参照Material-UI top 日本語ページmaterial-ui/examples/nextjs/Icon from material-uiIcon一覧yarn add @material-ui/coreyarn add @material-ui/iconscreate src/pages/index.jsxsrcディレクトリを作成し、下にpagesを収める。src/components/Layout.jsxの作成複数ページで共通デザインとなるLayout.jsxを作成する。ここでは省略したが、`の中には、material-ui`を利用したpermanent-drawerとモバイル用のswipeable-drawerを実装した。/src/components/Layout.jsx// src/components/Layout.jsximport React from 'react'import Link from 'next/link'import { makeStyles, useTheme } from '@material-ui/core/styles'import Hidden from '@material-ui/core/Hidden'import SwipeableDrawer from '@material-ui/core/SwipeableDrawer'import Drawer from '@material-ui/core/Drawer'import DoubleArrowIcon from '@material-ui/icons/DoubleArrow'import { List, ListItem, ListItemIcon, ListItemText, Divider } from '@material-ui/core'import HomeIcon from '@material-ui/icons/Home'import { MyDrawerList } from '../components/MyDrawerList'const drawerWidth = 250const useStyles = makeStyles((theme) => ({// ...}))export function Layout({ children }) {// ...const [state, setState] = React.useState({left: false,})// swipeable-drawerの開閉を制御するボタンconst toggleDrawer = (anchor, open) => (event) => {if (event && event.type === 'keydown' && (event.key === 'Tab' || event.key === 'Shift')) {return}setState({ ...state, [anchor]: open })}const HomeDrawerList = () => {return (// ...)}return (// モバイル端末用// if display-width > 1280px, display: none// 非モバイルディスプレイ用// if device-width{children}{`// ...`})}pages/index.jsxの作成まだReact等に不慣れなので、pages/index.jsにサイト1ページ目を作りこんで、後からcomponentに分割する方式をとった。色々試した結果、サイトトップにあたる pages/index.jsxは下の様になった。また、`用のデータは/public/manifest.json`から持ってくる事にした。// src/pages/index.jsximport React from 'react'import Head from 'next/head'import { Layout } from '../components/Layout'import { Top, About, History, Works } from '../components/HomeContents'const manifest = require('../../public/manifest.json')export default function Home() {return ({manifest.name}{`// ...`})}/src/components/HomeContetnts.jsx// src/components/HomeContetnts.jsximport React from 'react'import Link from 'next/link'import Grid from '@material-ui/core/Grid'export function Top() {return ()}export function About() {return (About...My name is Kawano Yudai.I graduated from Miyazaki Universiy as Bachelor of Agriculture.I belonged to agricultural engineering lablatory and studied crop row detecting tech by image processing with C++ and OpenCV.Now, I'm seeking job as developer. Please contact me from left drawer.);}export function Works() {return ()}export function History() {return ()}app.jsx, document.jsx, 404.jsx参照Custom App from Next.jsCustom Document from Next.jsCustom Error Page from Next.js_app.jsxglobal cssを追加する場所_document.jsxSSRされる箇所なので、onclickなどイベントハンドラは動かない`の外側にあるコンポーネントはブラウザによる初期化がされないので、Appロジック等はapp.jsx`に記述`や、styled-jsx`を書いちゃ駄目。Posts周辺の作成ダイナミックルーティング参照Next.js - PagesNext.js - Dynamic routesDocs - next/routes from Next.jsディレクトリ構成pages (*directory)index.jsxposts (*directory)hoge.jsx[id].jsxまた、/pages/posts/[id].jsxは// /pages/posts/[id].jsximport useRouter from 'next/route'export default function Post(){const router = useRouter()const { id } = router.queryreturn Post: {id}}ファイル名に[]が付いてるので変に見えるが。例えばlocalhost:3000/posts/hoge/にアクセスするとpages/posts/hoge.jsxが読み込まれるlocalhost:3000/posts/foobarだと、pages/posts/foobar.jsxが読み込まれ、dynamic routeとLink( next/link )を併用する時は、hrefに合わせてasも使う。getStaticProps, getStaticPaths今回はmdファイルを/src/pages/docsに入れる。baseUrl/postsへのアクセス時は、docs下のmdファイルを読込み、posts一覧の出力baseUrl/posts/[id]の場合は、同様にして、post単体の出力baseUrl/tagsの場合は、同様にpostsで使用されている投稿タグ一覧の出力baseUrl/tags/[tag]なら、同タグを使用するposts一覧を出力docs配下に無いmdファイル名にアクセスした場合は、404ページ出力がsrc/pages/docs/xxx.mdという外部データに依存した静的ページ出力をしたいので、getStaticPropsとgetStaticPathsを使用した。参照: Data fetching - Next.jsStatic Generation with Data - Next.js PagesgetStaticProps出力ページのコンテンツが外部データに依存している時に使用getStaticPaths出力ページ中のリンクが外部データに依存している時に使用実装は下を参照しながらしました。タグの方は自分で用意しましたが。Next.jsのチュートリアルのこのページtagsページのスタイルが未だ・・・マークダウン実現したい事QiitaやGist等での投稿を可能な限り手間なく集約したいmdxjs/mdxなら、ファイル中にimportやexport等のjsを組み込める。最終的に利用したもの。jonschlinkert/ gray-matterprocessor: remarkjs/ remarkhighlighter: highlight.js構文木について、しっかり学ばねばと思いました。/src/lib/posts.jsx// /src/lib/posts.jsximport fs from 'fs'import path from 'path'import matter from 'gray-matter'import remark from 'remark'import html from 'remark-html'export async function getPostData(id) {const fullPath = path.join(postsDirectory, ${id}.md)const fileContents = fs.readFileSync(fullPath, 'utf8')const matterResult = matter(fileContents)const LowerCaseTags = matterResult.data.tags.map((tag) => (tag.toLowerCase()))const highlight = require('remark-highlight.js')const processedContent = await remark().use(highlight).use(html).process(matterResult.content)const contentHtml = processedContent.toString()return {id,contentHtml,LowerCaseTags,...matterResult.data,}}meta以前にrubyとjekyllで作ったgithubpagesと比較して、syntax-highlightが粗いので改善が必要front-matterdate: '2020-05-26'author: Kawano Yudaititle: 'Qiita: Next.jsでポートフォリオサイトを作成した'tags: [Qiita, React, Next.js]image: '/assets/posts/202003/miyazaki-oss1.jpg'slide: falseSNSシェアボタン// ./src/pages/posts/[id].jsxUPDATEREADME.md@ 2020-05-27参照: README.mdをカッコ可愛くデザインしてアプリの魅力を120%にするQiita投稿の公開に当たり、README.mdを充実させたnpm install 禁止@ 2020-05-27参照: yarnを使うプロジェクトでnpm installを禁止する方法特に理由はないがnpmの仕様を禁じることにした。Custom Domain@ 2020-06-01google domainで購入Vercel側でドメインを変更Google Domain側でdnsをvercel用に変更ns1.vercel-dns.comns2.vercel-dns.comGoogle Analytics@ 2020-06-05参照: vercel/next.js - examples/with-google-analyticsGoogleAnalytics側でIDを取得し、app.jsxとdocument.jsxを上コードに従って修正する。PWA implimentationnext-offline@ 2020-06-05参照：github - hanford/next-offlinenext-offlineを利用した。上リポジトリでも記載してあるが、Vercel( Now )のv1とv2で動作が違う。但し、現在はv2オンリーなので、同レポジトリ内にあるpackages/now2-exampleのnow.jsonとnext.config.jsonに倣えばよい。PWA@2020-06-25reference: shadowwalker / next-pwa最初に使った next-offline は更新が遅く、またexperimentalな部分を利用していた等の理由から、next-pwaに移行した。example から分かるように、非常にシンプルになった。// next.config.jsconst withPWA = require('next-pwa')module.exports = withPWA({pwa: {dest: 'public'}})TypeScirpt@2020-06-30Next.jsのTS化は非常に簡単で、最初のうちはNext.js Learn Typesciptなどに従えば良い。touch tsconfig.jsonIf you’re using Yarnyarn add --dev typescript @types/react @types/nodeあとは、Learn 等に従って、ts化していけば、何となく理解できる。また、tsconfig.jsonでallowJs:trueにしておけば、もし仮に型が解らんものを含むjsファイルはそのままにしておいて、理解が進んでから完全にts化すればいいのでは。TSの理解を深める為に、読んだものQiita: tsconfig.jsonの全オプションを理解する（随時追加中）by @ryokkkkeQiita: TypeScriptの型入門 by @uhyoQiita: TypeScriptの型推論詳説 by @uhyo私的TypeScriptとの関わり方ガイドライン from 角待ちは対空npm-scriptmizchi氏のブログ等を見てて、npm-script や EsModule 等を知った。ちょうど、sitemap.mxlを造る必要があったので、利用することにした。pagesMap.json => sitmap.mxlpagesMap.json + history.json => rssただ、node v12 では ESModule は未だ experimental な機能で、package.json にも node --experimental-modules test.mjs とする必要がある。しかし、v13からはフラグが要らないので、nodejsをアップデートした。n --stable=> 12.18.2n --latest=> 14.5.0n latestnode -v=> v14.4.0vercel は nodejs の LTS しか対応しないので、package.json 中の npm-script は build 用 と generate script用で分ける必要があった。\"scripts\": {\"dev\": \"next dev\",\"build\": \"next build\",\"local-build\": \"next build && node script/genRobots.mjs && node script/genPostsMap.mjs && node script/genSiteMap.mjs && node script/genRss.mjs && node script/genAtom.mjs\",\"start\": \"next start\",},mjsについて未だ良く解らん事、作るのが自分用のファイルジェネレーターであることもあって、コードが汚いので・・・↓pages.json@2020-06-30postの情報を集約した postPages.json を作成した。ファイル更新履歴等はそのうち github から取得できるようにしたい。JSON.stringify が良く解らなかったので、読んだもの。JSON.stringifyを改めて調べる。 @qoAop作りたいファイル構成// {//id: '20200526-next-portfolio',//title: 'Qiita: Next.jsでポートフォリオサイトを作成した',//create: '2020-05-26',//update: '2020-06-05',//tags: ['qiita', 'react', 'next.js', 'remark.js', 'vercel'],// },postsMap generator script// script/genPagesMap.mjsimport path from 'path'import fs from 'fs'import matter from 'gray-matter'const postsDirectory = path.join(process.cwd(), 'src/docs')const fileNames = fs.readdirSync(postsDirectory)const allPostsData = fileNames.map((fileName) => {const id = fileName.replace(/\\.md$/, '')const fullPath = path.join(postsDirectory, fileName)const fileContents = fs.readFileSync(fullPath, 'utf8')const matterResult = matter(fileContents)const LowerCaseTags = matterResult.data.tags.map((tag) => (tag.toLowerCase()))const title = matterResult.data.titleconst create = matterResult.data.createconst update = matterResult.data.update || ''const tags = LowerCaseTags || ''return {id,title,create,update,tags}})const sortedPostsData = allPostsData.sort((a, b) => {if (a.createsitemap.xml@2020-07-01kuflash / react-router-sitemap や IlusionDev / nextjs-sitemap-generator等があるが、next.js なので、react-router を使ってないし、xml の構造は簡単そうだったので自作した。sitemap.xml を知るために読んだものsitemaps.org - サイトマップの XML 形式Google Search Home - Products > Search for Developers > Guides > Separate URLsSearch Console help サイトマップについてsitemap.xml の基本構成http://www.example.com/2005-01-01daily1.0xmlはファイル頭に空白行が入ると、``の宣言が無いと言ってエラーを吐くsitemap.xml generator script// script/genSiteMap.mjsimport path from 'path'import fs from 'fs'const base = 'https://oriverk.dev'const fixed = [{ url: base, update: '2020-06-26' },{ url: '/posts', update: '2020-06-30' },{ url: '/tags', update: '2020-06-26' }]const posts = JSON.parse(fs.readFileSync(path.join(process.cwd(), 'gen/postPages.json'), 'utf8'))const sitemap = `${fixed.map((f) => {return `${base === f.url ? base : base + f.url}${f.update}daily1.0`}).join(\"\")}${posts.map((post) => { return `${base}/posts/${post.id}${post.update || post.create}daily1.0`}).join(\"\")}`fs.writeFileSync(path.join(process.cwd(), \"public/sitemap.xml\"), sitemap)RSS & Atom@2020-07-01RSS 2.0 と Atom 1.0 に対応する。読んだものGoogle Margant Center ヘルプ - RSS 2.0 仕様Google Margant Center ヘルプ - Atom 1.0 仕様PHP & JavaScript Room - RSS 2.0 のフォーマット- RSS 2.0 フォーマットhogehoge foobarhttp://example.com/aaaaaaaaaaaaaaaategetege mikanhttp://example.com/post3.htmlthis is descriptionWed, 11 Jun 2008 15:30:59 +0900- Atom 1.0 フォーマット\ttag:example.comfeed/\texample.com update info\t2020-06-11T15:30:59Zhttp://example.com/post1.html#20080609205030foobar2020-06-09T20:50:30ZfoofoooofoooRSS と Atom のジェネレーターコードは、基本的に sitemap.xml と同じなので。RSS 2.0 ジェネレーター// script/genRss.mjsimport path from 'path'import fs from 'fs'const base = {url: 'https://oriverk.dev',title: \"Kawano Yudai's site\",desc: \"This site is for my portfolio and made with React, Next.js\"}const posts = JSON.parse(fs.readFileSync(path.join(process.cwd(), 'gen/postPages.json'), 'utf8'))const rss = `${base.title}${base.url}${base.desc}ja${new Date()}/${posts.map((post) => {return `${post.title}${base.url}/posts/${post.id}${post.tags.join(', ')}${post.create}`}).join('')}`fs.writeFileSync(path.join(process.cwd(),'public/rss.xml'), rss)Atom 1.0 ジェネレーターAtom の ユニークid をどうしようかと考えましたが、適当に。// script/genRss.mjsimport path from 'path'import fs from 'fs-extra'const base = {url: 'https://oriverk.dev',title: \"Kawano Yudai's site\",desc: \"This site is for my portfolio and made with React, Next.js\"}const posts = JSON.parse(fs.readFileSync(path.join(process.cwd(), 'gen/postPages.json'), 'utf8'))const atom = `${base.url}${base.title}${new Date()}${posts.map((post) => {return `${post.id}${post.title}${post.update || post.create}${post.tags.join(', ')}`}).join('')}`fs.writeFileSync(path.join(process.cwd(), 'public/atom.xml'), atom)To doCSSの統一AMP対応( 参照：Next.js next/amp/tagsページの整備コードブロックの言語またはファイル名の出力syntax-highlightの改善検索機能postページの目次機能モバイル用 bottom navigation の設置og:image 動的生成コード"
  },
  {
    "id": "20200329-joined-corona-oss",
    "title": "Qiita: 宮崎県 COVID-19 対策サイトの OSS 活動に参加した。",
    "create": "2020-03-29",
    "update": "2020-04-07",
    "tags": [
      "oss",
      "vue"
    ],
    "content": "from Qita: 宮崎県COVID-19対策サイトを見つけ、出身者として何かしたいと思ったから、した。出身の宮崎県用の対策サイトが出来、同時に感染者数が3人に増えていたことを知った。何かできる事は無いかと思ったので、Qiitaに記録しつつ、色々やってみた。IntroductionReferrence宮崎県 新型コロナウイルス 対策サイトGithub covid19-miyazaki/covid19東京都 新型コロナウイルス 対策サイトtokyo-metropolitan-gov/covid19Qiita: 東京都 新型コロナウイルス対策サイトへの貢献方法を解説EnvironmentUbuntu 18.04 ( vm with VagrantNode.js: v12.16. (>= 10.19.0yarn: 1.22.4environment setupRefferrenceGithub: リポジトリのREADME.md中の開発者向け情報->環境構築の手順Gitの設定（今回は新しくvm環境を用意したので。git config --global user.name \"usename\"git config --global user.email \"email\"Vimの設定oriverk/dotfiles/.vimrcからコピペ環境のデフォルトエディタを変更し、vimを選択sudo update-alternatives --config editorVue用の仮想環境を用意した。（割愛仮想環境をUbuntu 18.04 （CUI/GUI）で構築するNode.js >= v10.19.0の用意（割愛Ubuntuで使う言語のインストール方法とか環境構築とかfork, clone, yarn installgit clone https://github.com/oriverk/covid19.gitcd covid19yarn installyarn devWhat I did最初に書いた通り、Vue（と言うかJS）何もわからないので、表示される自然言語の修正をする事にした。表示言語選択メニューバー: covid19/nuxt-i18n.config.ts他言語表示用json: covid19/assets/locales/CODEOFCONDUCT.mdの修正東京都verから宮崎県verにした際の地域表記変更の漏れであり、1文字の修正だった。CODEOFCONDUCT.md 県庁の人だけでなく -->git add .git commit -m \"都庁を県庁に修正\" --no-verifygit push コピーしてきたURL developmentはじめてのpull requestPRの機会は初めてだったので、下を参照しながら行った。参照: 東京都 新型コロナウイルス対策サイトへの貢献方法を解説やってることは同じなので割愛。こんな感じで書いた。無事にpull requestがmergeされ、OSS活動(?)の実績解除となりました。What I wanna do表示自然言語の部分を中心に修正改善Warningと出ている部分の修正恐らくTypescriptの型由来の警告なので、ドキュメントと格闘しながら。"
  },
  {
    "id": "20200204-update-githubpages",
    "title": "GithubPages のメジャーアップデートをした。",
    "create": "2020-02-04",
    "update": "",
    "tags": [
      "githubpages",
      "jekyll",
      "ruby"
    ],
    "content": "What I didIntroduce IE BusterUpdate Ruby version from 2.5.1Make Dark-theme betterAdd top-image and githubpage-svgIE Busterリンク: IE BusterIE環境下ではSVG周辺でデザインが崩れることが確認されたが、Chrome使用を促すJSを追加した。Update Ruby-version to 2.7.0Ruby用に作成している仮想環境のアップデートの序にRubyのバージョンを最新版に上げた。参照: 永久保存版！？伊藤さん式・Railsアプリのアップグレード手順エラー内容他のgemやミドルウェアとの依存関係に由来するものrubyのキーワード因数に関する非推奨警告Dark theme前回までは、基本グレーで背景に青、差し色でオレンジを使用していた。参照Material Design Dark themeColor ToolDarkModeのデザインを中心とした色彩設計の考え方Add top-image and othersトップ画面にプロフィール画像を追加し、またサイトリンクQRコードを表示されるように、javascriptを作成した。'use script';{const githubpage = document.getElementById('githubpage-svg');const profile = document.getElementById('profile-img');profile.addEventListener('click', ()=>{profile.classList.remove('active');githubpage.classList.add('active');});githubpage.addEventListener('click', ()=>{githubpage.classList.remove('active');profile.classList.add('active');});}残す改修予定add TagsAMPの導入。"
  },
  {
    "id": "20200203-install-langs2ubuntu",
    "title": "Gist: installl langs to ubuntu",
    "create": "2020-02-03",
    "update": "2020-03-17",
    "tags": [
      "java",
      "node",
      "rails",
      "ruby",
      "rust",
      "ubuntu"
    ],
    "content": "from Gist: oriverk/InstallLanguage2Ubuntu.mdRuby on RailsRefferenceWSL+Ubuntuで、ruby on rails6.00の環境を整えるHow to Install Ruby 2.6 & Rails 6 on Ubuntu 19.04Install latest versioninstall in one timesudo apt install autoconf bison build-essential libssl-dev libreadline-dev zlib1g-dev libncurses5-dev libffi-dev libgdbm-devinstall rbenvrbenv is tool to manage a few of ruby versions and enable to change ruby ver. project by project.git clone https://github.com/rbenv/rbenv.git ~/.rbenvecho 'export PATH=\"$HOME/.rbenv/bin:$PATH\"' >> ~/.bashrcecho 'eval \"$(rbenv init -)\"' >> ~/.bashrcsource ~/.bashrcgit clone https://github.com/rbenv/ruby-build.git \"$(rbenv root)\"/plugins/ruby-buildInstall rubyrbenv install --listrbenv install 2.〇.〇rbenv global 2.〇.〇Instal yarnRails6 needs webpacker, and Webpacker needs yarn to installcurl -sS https://dl.yarnpkg.com/debian/pubkey.gpg | sudo apt-key add -echo \"deb https://dl.yarnpkg.com/debian/ stable main\" | sudo tee /etc/apt/sources.list.d/yarn.listsudo apt updatesudo apt install yarnInstall Railsgem install rails --no-documentinstall webpackerinner Apprails webpacker:installInstall RubyonRails by \"apt install\"sudo apt install -y ruby ruby-dev build-essentialsudo apt install yarnsudo gem install rails\"-y\" means \"All Yes\"build-essential contain information about package to build Debian pack.If do not build Debian, build~ is not neededReferenceGolanguse goenv to install Gogoenv is package management tool which based on rbenvgit clone https://github.com/syndbg/goenv.git ~/.goenvmake pathecho 'export GOENV_ROOT=\"$HOME/.goenv\"' >> ~/.bashrcecho 'export PATH=\"$GOENV_ROOT/bin:$PATH\"' >> ~/.bashrcecho 'eval \"$(goenv init -)\"' >> ~/.bashrcreload shellexec $SHELLconfirm goenv versiongoenv --versioncheck available Golang ver.goenv install --listinstall Golanggoenv install 〇.〇.〇confirm available Golang ver.goenv versionsmake the Golang ver. available to use as globalgoenv global 〇.〇.〇goenv rehashconfirm Golang ver. that is available to usego versionNodejsrails6 uses webpacker, which needs nodejssudo apt install -y nodejs npminstall n-packagesudo npm install n -gconfirm stable nodejs vern --stableconfirm latest nodejs vern --latestby n-package, install nodesudo n stable( or latest )uninstal old nodejs and npm, and re-loginsudo apt purge -y nodejs npmexec $SHELL -lconfirmnode -vRustsudo apt install build-essentialinstall rustcurl https://sh.rustup.rs -sSf | shadd the passsource $HOME/.cargo/envJavasudo apt updatesudo apt install openjdk-11-jdkconfirmationjava --version`"
  },
  {
    "id": "20200128-install-database2ubuntu",
    "title": "Gist: how to install db to ubuntu",
    "create": "2020-01-28",
    "update": "2020-03-17",
    "tags": [
      "db",
      "mysql",
      "postgresql"
    ],
    "content": "from Gist: oriverk/InstallDB2Ubuntu.mdPostgreSQLsudo apt install postgresql libpq-devset postgreSQLmake adminsudo -u postgres createuser admin -slogin postgresql with adminsudo -u postgres psql-- in postgresql\\password admin\\qlogin posgresqlrails dbconsoleupdate psql upto 12.0 for ubuntu18.04add repositrymake /etc/apt/sources.list.d/pgdg.listwrite repositrysudo sh -c 'echo \"deb http://apt.postgresql.org/pub/repos/apt/ $(lsb_release -cs)-pgdg main\" > /etc/apt/sources.list.d/pgdg.list'add certification keysudo apt install curl ca-certificatescurl https://www.postgresql.org/media/keys/ACCC4CF8.asc | sudo apt-key add -update repositrysudo apt update && sudo apt upgradeinstallsudo apt install postgresql-12confirmationsudo su - postgrespsql-> psql (12.0 (Ubuntu 12.0-2.pgdg18.04+1))MySQLsudo apt -y install mysql-server libmysqlclient-devset passwordsudo mysqlsecureinstallationALTER USER 'root'@'localhost' IDENTIFIED WITH mysqlnativepassword BY 'TegetegePassword';flush privileges;Herokusudo snap install heroku --classicheroku login --interactive`"
  },
  {
    "id": "20200128-build-vm4ubuntu",
    "title": "Gist: how to build VM with linux Ubuntu",
    "create": "2020-01-28",
    "update": "2020-06-25",
    "tags": [
      "ubuntu",
      "vm"
    ],
    "content": "from Gist: oriverk/buildVMwithUbuntu.mdhow to build CUIvagrant initmkdir -p vm/MyVagrant/hogehogecd hogehogevagrant initmodify \"Vagrantfile\"specify vagrant-boxchange vagrant namespecify ipif build gui, uncomment `vb.gui = true'modify available ramVagrantfile-- mode: ruby --vi: set ft=ruby :All Vagrant configuration is done below. The \"2\" in Vagrant.configureconfigures the configuration version (we support older styles forbackwards compatibility). Please don't change it unless you know whatyou're doing.Vagrant.configure(\"2\") do |config|The most common configuration options are documented and commented below.For a complete reference, please see the online documentation athttps://docs.vagrantup.com.Every Vagrant development environment requires a box. You can search forboxes at https://vagrantcloud.com/search.config.vm.box = \"bento/ubuntu-20.04\"vagrant nameconfig.vm.define \"hogehoge\"Disable automatic box update checking. If you disable this, thenboxes will only be checked for updates when the user runsvagrant box outdated. This is not recommended.config.vm.boxcheckupdate = falseCreate a forwarded port mapping which allows access to a specific portwithin the machine from a port on the host machine. In the example below,accessing \"localhost:8080\" will access port 80 on the guest machine.NOTE: This will enable public access to the opened portconfig.vm.network \"forwarded_port\", guest: 80, host: 8080Create a forwarded port mapping which allows access to a specific portwithin the machine from a port on the host machine and only allow accessvia 127.0.0.1 to disable public accessconfig.vm.network \"forwardedport\", guest: 80, host: 8080, hostip: \"127.0.0.1\"Create a private network, which allows host-only access to the machineusing a specific IP.config.vm.network \"private_network\", ip: \"192.168.33.10\"Create a public network, which generally matched to bridged network.Bridged networks make the machine appear as another physical device onyour network.config.vm.network \"public_network\"Share an additional folder to the guest VM. The first argument isthe path on the host to the actual folder. The second argument isthe path on the guest to mount the folder. And the optional thirdargument is a set of non-required options.config.vm.syncedfolder \"../data\", \"/vagrantdata\"Provider-specific configuration so you can fine-tune variousbacking providers for Vagrant. These expose provider-specific options.Example for VirtualBox:config.vm.provider \"virtualbox\" do |vb|# Display the VirtualBox GUI when booting the machinevb.gui = true# Customize the amount of memory on the VM:vb.memory = \"8192\"endView the documentation for the provider you are using for moreinformation on available options.Enable provisioning with a shell script. Additional provisioners such asPuppet, Chef, Ansible, Salt, and Docker are also available. Please see thedocumentation for more information about their specific syntax and use.config.vm.provision \"shell\", inline:After Vagrantfile modification, do vagrant upsetup for remote-sshfor WSL@ setting informationvagrant ssh-config=> paste info to remote-ssh: open configuration fileInner SSHsudo apt updateIf build Desktop versudo apt install ubuntu-desktopsetup default editor (vim)reference: Gitをインストールしたら真っ先にやっておくべき初期設定delete nanosudo dpkg -P nanoselect vimsudo update-alternatives --config editorsetup githubgit config --global core.editor 'vim -c \"set fenc=utf-8\"'git config --global user.name \"First-name Family-name\"git config --global user.email \"username@example.com\"setup vimuse my dotfile repo on githubChange locale and timezonechange locale to ja_JP.utf-8make japanize environmetsudo locale-gen ja_JP.UTF-8when activate, activate with japaneseecho export LANG=ja_JP.UTF-8 >> ~/.profileapply the settingsource ~/.profilechange timezone to jstsudo timedatectl set-timezone Asia/Tokyoconfirmdate=> 2019年1月 30日 水曜日 14:49:48 JSTGUI版の構築GUI版を構築する際はVagrantfileの編集から少し異なる。VagrantfileVagrant.configure(\"2\") do |config|config.vm.box = \"bento/ubuntu-20.04\"config.vm.network \"private_network\", ip: \"192.168.33.10\"config.vm.provider \"virtualbox\" do |vb|vb.gui = truevb.memory = \"8192\"cpu の数vb.cpus = 4vb.customize [\"modifyvm\", :id,\"--vram\", \"256\", # ビデオメモリ確保（フルスクリーンモードにするため\"--clipboard\", \"bidirectional\", # クリップボードの共有\"--accelerate3d\", \"on\",\"--hwvirtex\", \"on\",\"--nestedpaging\", \"on\",\"--largepages\", \"on\",\"--ioapic\", \"on\",\"--pae\", \"on\",\"--paravirtprovider\", \"kvm\",]endend仮想環境の立ち上げvagrant upvagrant sshsudo apt updatesudo apt upgradeUbuntuデスクトップ版(GUI)をインストールするここで、非常に時間が掛かるので注意sudo apt install ubuntu-desktop"
  },
  {
    "id": "20200110-update-githubpages",
    "title": "Post ページを中心に改修した",
    "create": "2020-01-10",
    "update": "",
    "tags": [
      "githubpages",
      "jekyll",
      "ruby"
    ],
    "content": "改修結果改修内容デザインの変更dark thememobile first\tBootstrapの排除Posts.indexページの追加Post.showページの追加Syntax-highlighter Rougeの導入デザイン変更ページ表示速度を向上させるため、メニュータブにしか使っていないBootstrap由来のJSとCSSを排除し、自作のjsスクリプトを追加した。'use strict';{const menuItems = document.querySelectorAll('.menu li a');const contents = document.querySelectorAll('.content');menuItems.forEach(clickedItem => {clickedItem.addEventListener('click', e => {e.preventDefault();menuItems.forEach(item => {item.classList.remove('active');});clickedItem.classList.add('active');contents.forEach(content => {content.classList.remove('active');});document.getElementById(clickedItem.dataset.id).classList.add('active');});});}Syntax-highlighter Rougeの導入Posts.indexとPost.showページはjekyll通りなので割愛。コードのハイライトを有効化する為、Rougeを導入した。gem 'rouge'_config.ymlmarkdown: kramdownhighlighter: rougeこの場合だと通常通りのhighlightとendhighlightを用いるが、Qiitaの様なコードブロックの記法にしたかったので、kramdownのオプション等を指定した。(下)_config.ymlmarkdown: kramdownkramdown:input: GFMhard_wrap: falsehighlighter: rougeあとはrougify style []でシンタックスハイライト用のcss、今回はmolokaiを生成し、一部修正、適用させた。改修予定IE, Edge対応（IE対応は見送りました。)AMPの導入。興味があるだけ"
  },
  {
    "id": "20200106-fontsize-test",
    "title": "フォントサイズの確認",
    "create": "2020-01-06",
    "update": "",
    "tags": [
      "test"
    ],
    "content": "h2 tag あいうえおつれづれなるまゝに、日くらし、硯にむかひて、心に移りゆくよしなし事を、そこはかとなく書きつくれば、あやしうこそものぐるほしけれ・・・h3 tag あいうえおあいうえお祇園精舎の鐘の声、諸行無常の響きあり。 沙羅双樹の花の色、盛者必衰の理をあらはす。 奢れる人も久からず、ただ春の夜の夢のごとし。strong tag あいうえおol list1ol list2ol list3ul list1ul list2ul list3italic あいうえおrubyrequire 'redcarpet'markdown = Redcarpet.new(\"Hello World!\")puts markdown.to_htmlscss.content{display: none;}.content .active{display:block;}C++#include \"stdafx.h\"#include#include#include#include#include \"math.h\"#include \"mask.h\"#include \"BmpFileIO.h\"#include \"ColorConv.h\"#include \"Labeling.h\"#include \"binarization.h\"using namespace std;#pragma warning(disable : 4819 )IplImage* img = 0;int minpoint, maxpoint, X1, X2;int cp = 0, cp1 = 0, cp2 = 0, cp3 = 0;> quote あいうえお>> かくありし時過ぎて、世の中にいとものはかなく、とにもかくにもつかで、世に経ふ人ありけり。かたちとても人に似ず、心魂もあるにもあらで、かうものの要にもあらであるも、ことはりと思ひつつ、ただ臥し起き明かし暮らすままに、世の中に多かる古物語のはしなどを見れば、世に多かるそらごとだにあり、人にもあらぬ身の上まで書き日記して、めづらしきさまにもありなむ、天下の人の品高きやと問はむためしにもせよかし、とおぼゆるも、過ぎにし年月ごろのこともおぼつかなかりければ、さてありぬべきことなむ多かりける。a tag link あいうえおkatex$$y = x^3 + 2ax^2 + b$$"
  },
  {
    "id": "20191129-post-code2twitter",
    "title": "Qiita: Twitter に見栄え良くコード投稿したかった",
    "create": "2019-11-29",
    "update": "2020-03-10",
    "tags": [
      "aws",
      "rails",
      "ruby"
    ],
    "content": "from Qiita: Twitterにコードを身えばよく投稿したいはじめにきっかけ（こんな呟きを見かけた出来たものCodr0：https://codr0.herokuapp.com/Github : oriverk/CodrGithubPage作成の過程で収穫物Active Record Storage等のRails5.2Twitter Login方法と仕組みなどJSの基礎（getElementByIdやsetAttribute、文字カウントなどAWS S3関連XSS対策作成の前に作成要件マークダウン投稿、シンタックスハイライトgem: redcarpet, rouge投稿から画像生成html2canvas参照：html2canvas参照：JSでhtmlを画像化する方法(html2canvasの使い方) from 湧くべくAWS S3にog:image用の画像を保存作成の流れ：予定rails new codr, git init, heroku create、Active StorageAWS S3あれこれtwitter登録、ログイン機能作成開発環境vm : Linux Ubuntu (virtualbox + vagrant)Ruby 2.5.1p57Rails 5.2.3Postgresql実作業rails new codr -d postgresqlDB設定等は割愛GemGemfilegem 'mini_racer'gem 'rails-i18n'gem 'devise'gem 'omniauth'gem 'omniauth-twitter' # twitter logingem 'devise-i18n' # make devise japanizegem 'devise-i18n-views'gem 'redcarpet' # markdown processorgem 'rouge' # highlightergem 'meta-tags'gem 'aws-sdk-s3' # aws s3参照: kpumuk/meta-tagsrails.credentials.yml当初は.gitignoreとdotenv等を使っていたが、作成途中でRails5.2からのrails.credentials.ymlを利用した。復号化には/config/master.keyを利用。editor setting EDITOR=\"vim\" rails credentials:editedit credentials.ymlrails credentials:editshow credential.ymlrails credentials.yml:showherokuにmaster.keyを環境変数として指定heroku config:set ENV_VAR=\"環境変数\" --app \"アプリ名\"追加した変数を使用するにはRails.application.credentials.dig(:twitter, :API_Key)rails gあれこれdeviserails g devise:installrails g devise User name:StringAdd Admin column to Userrails g migration AddAdminToUsersadd setting at /db/migrate/20191103141531addadmintousers.rbadd_column :users, :admin, :boolean, default: falseadd views and controllers to modify deviserails g devise:controllers usersrails g devise:views usersjapanizeadd at /config/application.rbconfig.i18n.default_locale = :ja=> create /config/locale/devise.view.ja.ymlscaffold postrails g scaffold Post user:references name:string content:text date:datetimeActive Record Associations関連付け/app/model/userhas_many :postspostbelongs_to :user投稿関連マークダウン投稿参照：Redcarpet：Github基本：Redcarpet::Markdown.new(renderer, extensions = {}).render(@post.content)オプションやXSS対策等を追加したく、helperメソッドを作成した。app/helpers/posts_helper.rbModule PostsHelperrequire 'rouge/plugins/redcarpet'class RougeRedcarpetRendererh2, ## => h3level += 1\"#{text}\"endenddef markdown(text)render_options = {do not allow any user-inputted HTML in the output.filter_html: true,hard_wrap: true,}extensions = {で囲まれていない時は、リンクとして認識しないautolink: true,fencedcodeblocks: true,lax_spacing: true,nointraemphasis: true,strikethrough: true,superscript: true,tables: false,highlight: true,disableindentedcode_blocks: true,#の後にスペースが無くても良いかspaceafterheaders: false}renderer = RougeRedcarpetRenderer.new(render_options)Redcarpet::Markdown.new(renderer, extensions).render(text).html_safeendendhtml_safe => sanitizesanitizeヘルパーを使用した。ホワイトリスト方式app/views/posts/index.html.erbsanitize(html, options = {})投稿内容のデータ化、AWSへの画像保存Herokuでは画像保持がされないので、作成画像をAWS S3に保存し、og:imageに添付する形を取った。Webアプリ内で通常投稿showページ表示（同時にhtml2canvasでBase64としてデータ取得、hidden_fieldに格納Tweetボタン押す（Postされ、postモデル内でbase64をデコードActive Storageを通して、AWS S3に保存Active Storage参照: Active StorageRail5.2からの機能で、今までのcarrievaveやpaperclip等を使わずに、クラウドストレージ等へのアップロードが容易になる。今回はAWS S3を使った。set uprails active_storage:installrails g resource comment content:textrails db:migrateapp/models/post.rbclass Posthasmanyattached :prtscshasoneattached :prtscendapp/config/environments/ファイル保存先変更development.rbconfig.active_storage.service = :localproduction.rbconfig.active_storage.service = :amazonrails credentials:editでAWSアクセスキーとシークレットキーを追加。config/credentials.yml.encaws:accesskeyid:secretaccesskey:config/storage.ymltest:service: Diskroot:local:service: Diskroot:amazon:service: S3accesskeyid:secretaccesskey:region: ap-northeast-1bucket: codr0Gemfilegemが必要gem 'aws-sdk-s3', require: false今回は不要だったので、入れず。gem 'mini_magick'html2canvasTweetボタン押下時に画像をPostするためのフォームhidden_fieldを用意html2canvas.jsをapp/assets/javascriptsディレクトリ配下に保存。html上に置くscriptコードを改修app/views/posts/show.html.erbidはpost_prtscになる。app/views/layouts/application.html.erbhtml2canvas(document.querySelector(\"#capture\"),{scale:1, width:600}).then(canvas => {var base64 = canvas.toDataURL('image/jpeg', 1.0);document.getElementById('post_prtsc').setAttribute('value', base64);});Base64デコード参照python-twitter で BASE64 形式の画像をツイートするbase64でエンコードされた画像をActive Storageで保存するapp/models/post.rbattr_accessor :imgdef parse_base64(img)if img.present?data:image/jpeg;base64,/9j/4AAQSkZJRgABA・・・から/9j/4AA以降を選択取得content = img.split(',')[1]今回は、ユーザによる画像アップロード投稿ではなく、拡張子が決まっているfilename = Time.zone.now.to_s + '.jpg'decoded_data = Base64.decode64(content)String.IO.newにより、アプリ内に一時ファイルを作成しなくて済むprtsc.attach(io: StringIO.new(decoded_data), filename: filename)endendあとはpostscontrollerで、paramsから受け取ったBase64データを上のparsebase64(img)で変換し、保存すれば完了。AWS S3refferrenceAWS S3AWS上での登録、設定、バケット作成等は割愛。Tweet Share Buttonapp/views/layouts/application.html.erbvar base = 'https://twitter.com/intent/tweet?url=';var pageUrl = 'https://codr0.herokuapp.com/posts/' + document.getElementById('post_id').value;var option = '&buttonhashtag=Codr0&refsrc=twsrc%5Etfw';var href = base + pageUrl + option;var twit = document.getElementById('tweet');twit.addEventListener('click', function() {window.open( href );});og:imageに画像添付なお、headのmeta情報セットには、gem 'meta-tags'を使用serviceurl()とurlfor()参照service_url() from api.rubyonrailsurl_for() from rails guide基本的にはどちらも、ActiveStorageに保存したデータのUrlを取得するメソッドの様だ。どちらもセキュリティの為にリンクの有効期限が短いみたいだが、違いが分からなかった。今回はTweetボタン押下し、Tweetした際にog:imageとして表示されればいい。app/views/posts/show.html.erb画像がActive StorageでAWS S3に保存されて入ればTwitterログインTwitterDeveloperAccountが必要。割愛。参照gem 'omniauth-twitter'　githubdeviseの使い方（rails5版）ominiauth脆弱性に対するクックパドによるパッチ]app/models/user.rb参考ページと同じ基礎的な所は割愛する。class User < ApplicationRecorddef self.from_omniauth(auth)findorcreate_by!(provider: auth['provider'], uid: auth['uid']) do |user|一部割愛user.username = auth'info'SNS登録時は、ダミーメールを登録user.email = User.dummy_email(auth)endendSNS登録(providerが存在する)時は、パスワード要求をしないdef password_required?super && provider.blank?enddef self.newwithsession(params, session)if session['devise.user_attributes']new(session['devise.user_attributes']) do |user|user.attributes = paramsendelsesuperendendprivatedef self.dummy_email(auth)\"#{auth.uid}-#{auth.provider}@example.com\"endendTwitterのニックネームが取得できるようになったので、元からあるUserのnameテーブルは削除した。改修(加筆メディアクエリ想定ユーザは殆どスマホなのに、PCで作成し、CSSをPCの見た目でやってた。折角SCSSでやってるので、変数を利用した。app/assets/stylesheets/scaffold.scss// ディスプレイサイズが680pxまでなら。$tab: 680px;@mixin tab {@media (max-width: ($tab)) {@content;}}// .box {//@include tab {//background-color: blue;//};// }最後にgist等がコードスクショをog:imageで表示してくれたら全て済むのでは"
  },
  {
    "id": "20190829-fe-exam",
    "title": "Qiita: H30 秋基本情報技術者試験 問3システム",
    "create": "2019-08-29",
    "update": "",
    "tags": [
      "rails",
      "ruby"
    ],
    "content": "from Qiita: H30基本情報技術者試験問題3 DB問題H30秋基本情報技術者試験問3のコンサートに則したサイトを実際に作っていた。Refferrenceコンサート問題のGithubレポジトリ21日目：H30秋基本情報技術者試験の問3データベースプログラミングを2か月間、セブで学んできたTransaction for Payment controllerコンサートチケットの支払い時の、ポイント使用・追加あたりの、Paymentコントローラ内に実装。※※※なお、Userテーブルに所持金カラムを追加してないのでTransaction flowユーザはポイントUser.pointを持っている。購入時にUser.pointの一部／全部を支払額Sale.amountに充てることができる。使用ポイントSale.used_pointが更新される支払額から使用したUser.pointを引いたものが、決済額Payment.amountとなる。決済額Payment.amountのうち、既定の割合が付与ポイントPayment.added_pointとなる。ユーザのポイント残高は、(支払前の）User.point - Sale.usedpoint + Payment.addedpointで更新される。支払い完了の条件User.point、Sale.usedpoint、Payment.addedpointは全て0以上(>=0)モデル側のバリデーションvalidates :point, numericality: { greaterthanorequalto: 0 }利用User.point >= Sale.used_pointFalseとなる操作は悪意しかないので、トランザクション外のif文でImplement User.point、Sale.usedpoint、Payment.addedpointは全て0以上(>=0)それぞれのモデル.rbUservalidates :point, numericality: { greaterthanorequalto: 0 }Salevalidates :usedpoint, numericality: { greaterthanorequal_to: 0 }Paymentvalidates :addedpoint, numericality: { greaterthanorequal_to: 0 }users_controller.rbdef payment@user = # ...@sale = # ...@concert = # ...@payment = Payment.new(sale_id: @sale.id, date: Date.current)respond_to do |format|if current_user.pointelogger.error elogger.error e.backtrace.join(\"\\n\")@sale = # ...@concert = # ...format.html { render :confirm, notice: 'エラー' }endendendendまあ、駄目な部分もあると思う。が、まあ、"
  },
  {
    "id": "20190818-use-jekyll",
    "title": "Qiita: GithubPages で jekyll を使ってみよう。",
    "create": "2019-08-18",
    "update": "2019-12-01",
    "tags": [
      "githubpages",
      "jekyll",
      "ruby"
    ],
    "content": "from Qiita: GithubPagesでjekyllを使ってみようよりGithubPagesJekyllを利用し、静的ページを作成した。major update history20190825：GithubPages with jekyll 作成目的：自分の情報等を纏めるサイト作成の為remote theme：fongandrew / hydeout20191206：デザイン等変更目的：アクセシビリティ改善、デバイスによる見た目差を小さく作り替えた結果デザインを大幅修正した件EnvironmentWindowsvm OS: Linux Ubuntu Bento/BionicRuby ruby 2.5.1p57RefferrenceGithubPages：https://pages.github.com/Jekyll：https://jekyllrb.com/Jekyll Themes :hydeout幣GithubPagesリポジトリ：https://github.com/oriverk/oriverk.github.ioデフォルトのGithubPages作成jekyllの準備、作成gem install bundler jekylljekyll new oriverk.github.iogitリモートレポジトリ作成、git pushリポジトリ名を username.github.ioにすることGithub Pages HPより引用If the first part of the repository doesn’t exactly match your username, it won’t work, so make sure to get it right.デフォルト状態完成上記に従ったデフォルト状態では、テーマminimaが適用され、こんなページになる。jekyllテーマを変更参照：jekyll-theme-hydeout 4.0.2テーマをhydeoutに変更してみるこのテーマはgem版があるので、それを利用することにした。他のテーマは知らない。上記のjekyll new username.github.ipで作成したディレクトリに手を加えていく。まず、Gemfileを編集。デフォルトでは`gem \"github-pages\"がコメントアウトされてるので、アンコメント。また、今回使用するテーマhydeoutのgemを書き加える。Gemfileuncommentgem \"github-pages\", group: :jekyll_pluginsadd gemgem \"jekyll-theme-hydeout\"次に、_config.ymlを編集。今回はリモートテーマを使用するので、themeをremote_themeに変更する。更に、プラグインも追加しておく。_config.ymltheme: mininmaremote_theme: fongandrew/hydeoutplugins:jekyll-feed # 元から入っているjekyll-remote-theme　# addedgithub-pages # addedbundle installbundle exec jekyll serverこれで、テーマがhydeoutに変更されているはず。エラー参照：GitHub Pages ビルドのトラブルシューティングLayoutが見つからないエラー記事投稿中にターミナルログを消してしまって、エラー文を覚えていないが、該当の.mdファイル中のLayoutを、Layout:pageに変えたら、エラーが解消された。Invalid theme folder: _sass参照Invalid theme folder: sass when using Github Pages with remotetheme #7630Page build failed: Invalid Sass or SCSS参照先での議論を見る限り、問題ない・・・・？カスタマイズ※使用テーマやテーマの追加方法によって、ディレクトリ構造が違うので、他テーマは知らないディレクトリに_includeフォルダを作成。headタグ内の情報を書き込む_includeフォルダ内に、head.htmlファイルを作成する{% if page.title == \"Home\" %}{{ site.title }}{% if site.tagline %} &middot; {{ site.tagline }}{% endif %}{% else %}{{ page.title }} &middot; {{ site.title }}{% endif %}ページネーション機能jekyll関連gemにページネーションがあり、プラグインなので_config.ymlに書き加える。_config.ymlplugins:jekyll-paginatepaginate: 5paginate_path: '/blog/page:num'sidebarbloglink: '/blog'bundle installbundle exec jekyll serverGoogleアナリティクス参照: Google Analytics for Jekyllまず、GoogleアナリティクスをトラッキングIDを取得する。google-analytics.htmlを作成google-analytics.html{% if jekyll.environment == 'production' and site.google_analytics %}(function (i, s, o, g, r, a, m) {i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () {(i[r].q = i[r].q || []).push(arguments)}, i[r].l = 1 * new Date(); a = s.createElement(o),m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m)})(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');ga('create', '{{ site.google_analytics }}', 'auto');ga('send', 'pageview');{% endif %}_include/head.htmlに書き加える。{% include google-analytics.html %}_config.ymlにトラッキングIDを書き加えるトラッキングIDは、UA-　から始まるID。_config.ymlGoogle Analyticsgoogle_analytics: UA-〇〇〇〇〇githubに上げて完了。Twitterカード追加参照サルワカ：【2019年版】Twitterカードとは？使い方と設定方法まとめSupporting Twitter Cards with JekyllTwitter Cards on Jekyll_include/twitter-card.htmlを作成 -->{% if page.summary %}{% else %}{% endif %}{% if page.image %}{% else %}{% endif %}_include/head.html内に書き加える{% include twitter-card.html %}gitにpushし、Twitter Card Validator で確認sidebar-nav-linkこんな感じで、サイドバーにnav-link付け足したい。デザインを大幅修正した件改修方針モバイルファーストページ数を少なく。サイズ指定にpxを極力使わず、remや％を使う実作業git branch changeDesigngit checkout changeDesignGemfileと_config.ymlから不要なものを削除Gemfilesource 'https://rubygems.org'gem 'github-pages', group: :jekyll_pluginsgroup :jekyll_plugins dogem 'jekyll-admin'gem 'jekyll-feed', '~> 0.6'endinstallif -> { RUBYPLATFORM =~ /mingw|mswin|java/ } dogem 'tzinfo', '~> 1.2'gem 'tzinfo-data'endgem 'wdm', '~> 0.1.0', installif: Gem.winplatform?gem 'jekyll-coffeescript'最低限必要なディレクトリ構造を考える自分でデザインを構成するには、jekyllとliquidで出来る事を理解する必要があった。_include配下のファイルは{% include footer.html %}の形で変数展開の様に扱う。但し、画像はこの方法では利用できない。svgはok。_site中身はbundle exec jekyll serveで自動で生成されるので中身は触らない自分の結果....├── _config.yml├── _includes|├── svgファイル類|└── head内パーツ類（head.html, twitter-card, google-analytics, bootstrap ...|└── body内のhtmlパーツ類├── _layouts ─ default.html├── _posts─ 2007-10-29-why-every-programmer-should-play-nethack.md├── assets─ jpg / png 画像類└── index.html # can also be an 'index.md' with valid front matterスクロール関連の変更// _layout.scssbody{background-image:url(\"../taiwan.jpg\");background-size:cover;background-position: right;background-attachment:fixed;-ms-overflow-style: none; // IE用overflow: -moz-scrollbars-none; // Firefox用&::-webkit-scrollbar { // Chrome用display: none;}}"
  },
  {
    "id": "20190513-learned-programming",
    "title": "Qiita: プログラミングを2か月間、日本人エンジニアの下で学んできた",
    "create": "2019-05-13",
    "update": "2019-12-12",
    "tags": [
      "ruby"
    ],
    "content": "from Qiita: プログラミングを2か月間、日本人エンジニアの下でマンツーマンで学んできたWebエンジニアに転職するために、独りで勉強を進めていましたが、独学のデメリットを埋めるべく、Value Space of Cebuに参加してきました。尚、この投稿は、参加経緯や2か月間の感想等になります。私について2017年3月　農学学士　卒業2018年8月　新卒入社企業　退職2018年12月~2019年9月　オーストラリアでのワーキングホリデー2019年3~4月　セブでのプログラミング勉強専門は農学部植物系学科ですが、農業生産システム工学研究室に所属し、卒論は自動除草ロボット用の『雑草中の作物列検出する方法』の研究でした。使用言語はC++、ライブラリとしてOpenCVを使用。参加講座についてプログラミングについて調べている中で『プログラミング道場』というブログを知り、そのブログ主のジョージさんさんが2か月間の講師でした。3月からセブでプログラミング講座をするというtweetを見、参加しました。参加目的独学によるデメリットを少しでも埋める（独学だと、どうしても知識にムラや抜けが出てしまう。Rubyを学ぶProgateレベルのHTML、Git、ComandLineから、さらに理解を深めるWebエンジニアに会ったことがないので。場所フィリピンのセブ島のすぐ下のマクタン島講座開始前にしたこと。仮想環境（CUI）の構築、RubyonRailsの環境準備Ruby、Html、GitをProgateで一通りやること。講座内容毎日したことをアウトプットとして、Qiitaに投稿していました。1か月目時間割に沿って行われました。Ruby認定試験を用いた勉強参照：Ruby認定試験のアウトプット以下は例(以下省略)ファイルdataの内容はabcdefgFile.open(\"data\") do |io|while not io.eof?print io.read(1)io.seek(0,IO::SEEK_SET)endendScaffoldなしの掲示板BootstrapやDBを組み合わせ、生徒データ情報一覧になりました。一部、Bootstrap等を適用してないページがあるが、気にしない。MySQL参照6日目：MySQL操作12日目：PostgreSQLを用いたログイン機能付きサイト15日目：アプリをネットに公開したく、Herokuを使ってみた。RailsTutorialRailsTutorialの、テストの最初段以降を除いて、時折技術サポート受けながら、最初から最終章までしました。1か月目後半頃だったので、『既にやったぞ』という箇所が多かったです。2か月目主に基本情報技術者試験のセキュリティとDBの設問に費やしました。参照H30秋午後設問3アウトプット18日目：トランザクションって21日目：H30秋基本情報技術者試験の問3データベースJS等、追加で勉強しなければと感じています。2か月を終えて私が良かったなと思える点触ったことのなかったRubyを、上のサイト程度までには触れるようになった。SQLやGit、ComandLineのProgateレベルを脱することができた。この2か月間で、ああしとけば、今思う事。遠慮なく質問すればよかった。マンツーマンで、精神的に萎縮してしまった感じもする。最終的には自己解決が必要なのですが、勉強する場なのだから、遠慮せずに、と。私の今後ワーホリビザは11月末期限ですが、それを待たずにWebエンジニアとして転職したいと考えています。農学部出身、他業種出身からの未経験採用となので、厳しいと思いますが。今回関連で、することコンサートチケット申込購入サイトを完成させ、Heroku等にあげる。ツイッター登録やトランザクション実装、Topページ追加、デザイン修正、メール、バッチ処理の追加等々。。。RubyとGit等の理解をさらに深めるべく、勉強の継続。オリジナルのWebアプリを作成するなりして。転職に向け、することポートフォリオ作成他言語や、AWSやDocker、コンピュータサイエンス等の勉強転職サイトなど（そういや転職について何も知らない）リンク物置講師: ＠monkeydgeorgeValue Space of Cebuプログラミング道場私: https://oriverk.devGithub Acount注）『転職』といった形で恩を返す？事が出来ないので、今回の投稿となりました。"
  },
  {
    "id": "20190403-what-transaction",
    "title": "Qiita: 18日目: トランザクションって",
    "create": "2019-04-03",
    "update": "2019-12-04",
    "tags": [
      "mysql",
      "ruby"
    ],
    "content": "from Qiita: トランザクションって参照: 「トランザクション」とは何か？を超わかりやすく語ってみた！What is Transaction like?コンピュータ内で実行される、分けることのできない一連の情報処理の一単位。トランザクション処理における永続性記憶資源の管理では、複数のデータ項目の更新操作列をすべて実行するか、まったく実行しないように制御する必要がある。ACID 標準また、トランザクション処理システムは4つの属性の機能をサポートしており、頭文字からACID標準という。A : Atomic　不可分性C : Consistency　一貫性I : Isolation　独立性D : Durability　永続性実際に動かしてみるDB内で操作参照: 13.3.1 START TRANSACTION、COMMIT、および ROLLBACK 構文　-MySQLリファレンスMySQLはデフォルトで、自動コミットモードが有効になった状態で動作し、実行するとすぐに、ディスクに格納されて永続的になります。この変更はロールバックできない。自動コミットモードを暗黙的に無効にするには、START TRANSACTIONをし、その後、COMMITまたはROLLBACK で終了するまで、自動コミットは無効のままになります。そのあと、自動コミットモードはその以前の状態に戻ります。実作業今回はMySQLと、以前に作成した大学生徒データAppのデータを再利用するmysql -u root -p-- 使用するデータベース情報の選択USE cebucollegedevelopment;-- 使用するstudentsテーブルの構造を確認DESC students;+------------+--------------+------+-----+---------+----------------+| Field| Type| Null | Key | Default | Extra|+------------+--------------+------+-----+---------+----------------+| id| bigint(20)| NO| PRI | NULL| auto_increment || name| varchar(255) | YES|| NULL||| email| varchar(255) | YES|| NULL||| gender| int(11)| YES|| NULL||| age| int(11)| YES|| NULL||| opinion| text| YES|| NULL||| created_at | datetime| NO|| NULL||| updated_at | datetime| NO|| NULL||+------------+--------------+------+-----+---------+----------------+-- id=3のtaro-2さんを使ってみるSELECT name FROM students WHERE id = 3;+--------+| name|+--------+| taro-2 |+--------+COMMITするパターンSTART TRANSACTION;-- id=3のnameを\"tran-sakuko\"に更新UPDATE students SET name = \"tran-sakuko\" WHERE id = 3;-- Query OK, 1 row affected (0.01 sec)-- Rows matched: 1Changed: 1Warnings: 0-- 確認してみるSELECT name FROM students WHERE id =3;+-------------+| name|+-------------+| tran-sakuko |+-------------+1 row in set (0.00 sec)-- コミットするCOMMIT;-- Query OK, 0 rows affected (0.00 sec)-- COMMITされてるか確認-- select name from students where id =3;+-------------+| name|+-------------+| tran-sakuko |+-------------+1 row in set (0.00 sec)ROLLBACKするパターンSTART TRANSACTION;-- Query OK, 0 rows affected (0.00 sec)-- id=3のnameを\"tran sakutarou\"に更新UPDATE students SET name = \"tran sakutarou\" WHERE id =3;-- Query OK, 1 row affected (0.00 sec)Rows matched: 1Changed: 1Warnings: 0-- id3のnameに新しいデータの\"tran sakutarou\"がセットされてるSELECT name FROM students WHERE id = 3;+----------------+| name|+----------------+| tran sakutarou |+----------------+1 row in set (0.00 sec)ロールバックしてみるROLLBACK;-- Query OK, 0 rows affected (0.01 sec)-- セットした\"trans sakutarou\"というデータはDBに格納されない。SELECT name FROM students WHERE id = 3;+-------------+| name|+-------------+| tran-sakuko |+-------------+1 row in set (0.00 sec)try on RubyonRails新しく、アプリを作成する。今回はDBの操作だけなので、rails g modelコマンドのみ使用テーブルはUserとReviewの２つ。rails new transact_self -d mysqldatabase.ymlを編集後rails db:createUserモデル作成rails g model User name:string approved:boolean deleted:booleanReviewモデル作成rails g model Review user:references rate:integer approved:booleanrails db:migrateinput datauser(1..5).each do |i|User.create(name: \"taro-#{i}\", approved: true, deleted: false)end(1..5).each do |i|user = User.firstReview.create!(user_id: user.id, rate: i, approved: true)endDB内で確認SELECT * FROM users;+----+--------+----------+---------+---------------------+---------------------+| id | name| approved | deleted | createdat| updatedat|+----+--------+----------+---------+---------------------+---------------------+|1 | taro-1 |1 |0 | 2019-04-03 09:01:31 | 2019-04-03 09:01:31 ||2 | taro-2 |1 |0 | 2019-04-03 09:01:31 | 2019-04-03 09:01:31 ||3 | taro-3 |1 |0 | 2019-04-03 09:01:31 | 2019-04-03 09:01:31 ||4 | taro-4 |1 |0 | 2019-04-03 09:01:31 | 2019-04-03 09:01:31 ||5 | taro-5 |1 |0 | 2019-04-03 09:01:31 | 2019-04-03 09:01:31 |+----+--------+----------+---------+---------------------+---------------------+SELECT * FROM reviews;+----+---------+------+----------+---------------------+---------------------+| id | userid | rate | approved | createdat| updated_at|+----+---------+------+----------+---------------------+---------------------+|1 |1 |1 |1 | 2019-04-03 09:01:38 | 2019-04-03 09:01:38 ||2 |1 |2 |1 | 2019-04-03 09:01:38 | 2019-04-03 09:01:38 ||3 |1 |3 |1 | 2019-04-03 09:01:38 | 2019-04-03 09:01:38 ||4 |1 |4 |1 | 2019-04-03 09:01:38 | 2019-04-03 09:01:38 ||5 |1 |5 |1 | 2019-04-03 09:01:38 | 2019-04-03 09:01:38 |+----+---------+------+----------+---------------------+---------------------+userとreviewとの、関連付けapp/models/user.rbclass User (0.1ms)BEGINUser Update (0.3ms)UPDATE users SET approved = FALSE, updated_at = '2019-04-03 09:10:46' WHERE users.id = 1Review Load (0.2ms)SELECT reviews.* FROM reviews WHERE reviews.user_id = 1(6.8ms)COMMIT=> ,#,#,userテーブルのid1のtaro-1が、更新されてるselect * from users;+----+--------+----------+---------+---------------------+---------------------+| id | name| approved | deleted | createdat| updatedat|+----+--------+----------+---------+---------------------+---------------------+|1 | taro-1 |0 |0 | 2019-04-03 09:01:31 | 2019-04-03 09:10:46 |トランザクション処理に失敗し、rollbackされるパターンuser = User.firstUser.transaction douser.update!(approved: true)user.reviews.each { |review| review.update!(approved: false) }end=>(0.1ms)BEGINUser Update (0.2ms)UPDATE users SET approved = TRUE, updated_at = '2019-04-03 09:14:44' WHERE users.id = 1Review Load (0.2ms)SELECT reviews.* FROM reviews WHERE reviews.user_id = 1(6.6ms)ROLLBACKTraceback (most recent call last):3: from (irb):22: from (irb):4:in `block in irb_binding'1: from (irb):4:in `block (2 levels) in irb_binding'ActiveRecord::RecordInvalid (Validation failed: Approved can't be blank)トランザクション処理に失敗し、rollbackしたため、DBに変化はない。modelファイルを編集して実装app/models/user.rbclass User < ApplicationRecordhas_many :reviewsdef suspend!self.class.transaction dodisapprove_user!disapprove_reviews!endendprivatedef disapprove_user!self.update!(approved: false)enddef disapprove_reviews!reviews.each { |review| review.update!(approved: false) }endend"
  },
  {
    "id": "20190329-add-admin-with-devise",
    "title": "Qiita: 16日目：devise で管理者を追加する",
    "create": "2019-03-29",
    "update": "2019-12-04",
    "tags": [
      "rails",
      "ruby"
    ],
    "content": "from Qiita: deviseだけで管理者を追加したいEnvironment仮想環境: Ubuntu 18.04Ruby：2.51Rails: 5.2.2gem: 'devise'（ログイン等の機能用), 'kaminari'( pagination )DB: PostgreSQL実作業テーブルにadminカラム追加rails g migration Addカラム名Toテーブル名　カラム定義rails g migration AddAdminToStudent admin:booleanboolean型真理値の「真 = true」と「偽 = false」という2値をとるデータ型のこと。Rubyでは偽はfalseとnilで、それ以外がtrueになる。言語やDBによっては、1と0だったり、違うので注意。マイグレーションファイルを編集boolean型と定義する際は、デフォルト値を設定しないといけない。adminのデフォルト値に引数falseを渡し、デフォルトではadmin権限がない、と指定する。/db/migrate/20190328011407addadmintostudent.rbclass AddAdminToStudent falsestu.admin = truestu.savestu.admin?=>trueadmin属性が追加され、またadmin?メソッドを使用できるようになっている。adminのみが全データを見れるようにするadmin以外は、自分のデータしか見れないようにしたい。users_controller.rb def indexif current_student.admin?@students = Student.page params[:page]else@student = current_studentendendapp/views/student`"
  },
  {
    "id": "20190328-use-heroku",
    "title": "Qiita: 15日目： Heroku でアプリを公開しよう",
    "create": "2019-03-28",
    "update": "2019-12-04",
    "tags": [
      "heroku",
      "rails",
      "ruby"
    ],
    "content": "from Qiita: アプリをネットに公開したく、Herokuを使ってみた。What is PaaS> PaaS - 富士通>> アプリケーションを開発・実行するために必要なハードウェア、OSなどの環境をネットワーク経由で利用する形態 。開発・実行環境が提供されるため、企業ごとに独自のサービスを構築できる。Environment仮想環境: Ubuntu 18.04Ruby：2.51Rails: 5.2.2devise: for authenticationkaminari: for paginationDB: PostgreSQLContentHeroku setupRefferrenceGetting Started on Heroku with RubyAfter signup heroku, then install herokusudo snap install heroku --clasiclogin herokuheroku login --interactive=>heroku: Press any key to open up the browser to login or q to exit›Warning: If browser does not open, visit›https://cli-auth.heroku.com/auth/browser/*heroku: Waiting for login...Logging in... doneLogged in as me@example.comdeploy app to herokuアプリのソースコードを受け取るHerokuを準備するheroku create出力例Creating polar-inlet-4930... done, stack is cedar-14http://polar-inlet-4930.herokuapp.com/ | https://git.heroku.com/polar-inlet-4930.gitGit remote heroku addedgit add .git commit -m \"init\"git push heroku masterheroku run rails db:migrateother heroku commandHeroku上にデータを追加するheroku run rails console操作ログを見るheroku logs --tailHeroku上のファイルの詳細を見るheroku \"ls -l\"Heroku上のアプリのURLとその他を確認heroku info`"
  },
  {
    "id": "20190324-app-with-devise",
    "title": "Qiita: 13日目(1)： Devise によるログイン機能付きサイトの作成",
    "create": "2019-03-24",
    "update": "2019-12-04",
    "tags": [
      "rails",
      "ruby"
    ],
    "content": "from Qiita:13日目(1)：Deviseによるログイン機能付きサイトの作成12日目：12日目：PostgreSQLを用いたログイン機能付きサイトの続きEnvironment仮想環境OS: Ubuntu 18.04Ruby：2.51Rails: 5.2.2devise)DB: PostgreSQLflowcontrollersとviewsを以前の大学データの方から流用migrationファイル作成rooting変更Contentsmake migration filerails g migration AddNameToStudents name:string gender:integer age:integer opinion:text実行createdb/migrate/20190324043018addnametostudents.rbreflect change to DBrails db:migratemodify routingapp/confing/routes.rb追加resources :studentsroot to: 'students#index'modify viewsapp/views/student.html.erb今回不要なExamResultNewのリンク削除ログアウトリンクの作成modify controllerapp/controllers/student_controller.rbclass StudentsController < ApplicationControllerbeforeaction :authenticatestudent!end`"
  },
  {
    "id": "20190320-what-git",
    "title": "Qiita: 10～12日目： Git",
    "create": "2019-03-20",
    "update": "",
    "tags": [
      "git"
    ],
    "content": "from Qiita:10日目(2)：Git11日目(2)と12日目：Git10日目Firstwhat is Gitプログラムのソースコードなどの変更履歴を記録・追跡するための分散型バージョン管理システムGit command flowprepare to use Gitgit init共同開発の流れコード変更共有準備共有コマンド共有する準備共有したいファイルを選択git add ファイル名git add indext.htmlコミット選択したファイルを記録するgit commit -m \"適当なメッセージ\"git commit -m \"Create index.html\"共有リモートを登録リモートとは、Git共有ファイルの置き場所また、originはリモート名のことgit remote add origin URL名push: リモートにファイルアップロードgit putsh origin mastaerpull: リモート上のファイルをDLgit pull origin masterその他コマンド変更ファイル名を表示git status#変更コードを表示git diffコミット履歴を見るgit logコミット履歴と変更内容を見るgit log -p11日目Github上でリポジトリ作成ローカルリポジトリ作成echo \"# self-repo\" >> README.mdgit initgit add README.mdgit commit -m \"first commit\"git remote add origin https://github.com/oriverk/self-repo.gitgit push -u origin master実行結果Read.mdファイル作成github上のリポジトリにRead.mdファイルがプッシュ。Branch 'master' set up to track remote branch 'master' from 'origin'.gitリモートの確認git remote -v実行originhttps://github.com/oriverk/self-repo.git (fetch)originhttps://github.com/oriverk/self-repo.git (push)git loggit log実行commit e2282c28ea661e588143201d9109ed9572f3d276 (HEAD -> master, origin/master)Author: oriverkDate:Wed Mar 20 22:09:38 2019 +0000first commit自分でpushしてみるファイル作成touch tes1.txttouch tes2.txtgit addgit add tes1.txtgit add tes2.txtgit commitgit commit -m \"second commit\"実行結果[master 5b5b220] second commit2 files changed, 0 insertions(+), 0 deletions(-)create mode 100644 tes1.txtcreate mode 100644 tes2.txtgit loggit log実行結果commit 5b5b220fce07f6772b9aeeca1fe60d9ba0e63c74 (HEAD -> master)Author: oriverkDate:Wed Mar 20 22:25:49 2019 +0000second commitdiff --git a/tes1.txt b/tes1.txtnew file mode 100644index 0000000..e69de29diff --git a/tes2.txt b/tes2.txtnew file mode 100644index 0000000..e69de29#githubに反映git push origin master実行結果Counting objects: 3, done.Compressing objects: 100% (2/2), done.Writing objects: 100% (3/3), 283 bytes | 141.00 KiB/s, done.Total 3 (delta 0), reused 0 (delta 0)To https://github.com/oriverk/self-repo.gite2282c2..5b5b220master -> master確かに反映されているinteractive mode対話モードの呼び出しgit add -i対話モード* Commands *1: status2: update3: revert4: add untracked5: patch6: diff7: quit8: help1：ステータス確認　2：ファイルをステージ　3：ステージを取り消す4：一度もトラッキングされていない新規ファイルをステージする5：部分的にステージ　6：ステージしたファイルの差分確認2つのファイルをトラッキングし、tes2.txtのステージを取り消し、状態を確認* Commands *1: status2: update3: revert4: add untracked5: patch6: diff7: quit8: helpWhat now> 41: tes3.txt2: tes4.txtAdd untracked>> 1-2* 1: tes3.txt* 2: tes4.txtAdd untracked>>added 2 paths更新分をステージgit add -i5を選択肢、tes1.txtを選択更新分が表示されるy：ステージする　n:ステージしない　q:対話モードを終了Stage this hunk [y,n,q,a,d,e,?]? ygithubに反映git commit -m \"cat pass\"git push origin masterファイルを戻すファイルを削除rm tes1.txt元に戻す。直近の\"cat pass\"のバージョンが戻ったgit checkout tes1.txtバージョン指定で戻すgit logcommit 5b5b220fce07f6772b9aeeca1fe60d9ba0e63c74Author: oriverkDate:Wed Mar 20 22:25:49 2019 +0000second commit\"second commit\"のバージョンのtes1.txtに戻してみるgit checkout 5b5b220fce07f6772b9aeeca1fe60d9ba0e63c7 tes1.txt最新版に戻すgit reset --hard HEAD実行HEAD is now at 48bfffa cat pass最新版なので、tes1.txtも\"cat pass\"のバージョンに戻ってるブランチの確認、作成現在のブランチを確認git branch -v#実行master 48bfffa cat pass新規のブランチ作成git checkout -b other-branファイル編集し、other-branにpushcat /etc/mysql/conf.d/mysql.cnf >> tes1.txtcat /etc/apache2/conf-available/javascript-common.conf >> tes2.txtcat /etc/passwd >> tes3.txtcat /etc/nsswitch.conf >> tes4.txtgit commit -m :\"for other-bran\"git push origin other-branpull requestother-branブランチからmasterブランチにプルリクエストリモートの変更をローカルに反映masterブランチに移動git checkout master反映git pull origin master認証情報の追加push時に毎回パスワ等聞かれるので、作成するgit config --global --editユーザ名とメールを記入し、コメントインsshのkeyを作成既に授業で作成したので、実行はパスssh-keygen -t rsa -b 4096 -C \"自分のemail@gmail.com\"cat ~/.ssh/id_rsa.pubリポジトリのSetting内のDeployKeysに上のcatの結果をコピペこれで、pushを、パスワ等を聞かれずに実行できる。12日目ブランチの確認現在のブランチを確認git branch -l実行masternew-branch-jaji現在のブランチとその情報を確認git branch -v実行master50dc6c7 addednew-branch-joji be070c0 他のフィアルを追加リモートを含む、ブランチを確認git fetchgit branch -a実行vagrant@vagrant:~/cebu_lessons/mactan-repo$ git branch -amaster* new-branch-jojiremotes/origin/masterremotes/origin/new-branch-jojiremotes/origin/test-repogit fetchリモートブランチの最新の履歴だけを取得これをした状態でgit mergeをすると、git pullと同じ履歴になるgit pull = git fetch + git pull"
  },
  {
    "id": "20190320-input-data2db",
    "title": "Qiita: 10日目(1)：マスターデータ（ DB へ情報入力、ページに出力",
    "create": "2019-03-20",
    "update": "2019-12-04",
    "tags": [
      "mysql",
      "rails",
      "ruby"
    ],
    "content": "from Qiita: マスターデータ（DBへ情報入力、ページに出力Environment仮想環境OS: Ubuntu 18.04Ruby：2.51Rails:5.2.2テーブル同士の関連図流れ中間テーブルにデータ入力性別の0 or 1の表記を、male or femaleに変更Studentのshowページに、生徒ごとの試験結果等、データを出力実段階生徒データと関連付けするときはstudent1 = Student.firststudent1.clubs男性女性20代30代出力を考える学生ごとのshowページで表示したいもの生徒のデータ(name, mail, gender, age, opinion)生徒の教科ごとの試験結果点数性と全体の試験結果の平均点、最大点、最小点MySQL上の出力SELECTsubjects.name,CAST(AVG(examresults.score) as unsigned) as avgscore,MAX(examresults.score) as maxscore,MIN(examresults.score) as minscoreFROMstudentsINNER JOIN exam_resultsON students.id = examresults.studentidINNER JOIN subjectsON examresults.subjectid = subjects.idGROUP BY subjects.id, subjects.name-- =>+--------+--------------+-----------+-------+-------+| name| name| name| score | ratio |+--------+--------------+-----------+-------+-------+| taro-1 | 一次試験| 数学|181 |91 || taro-1 | 試験1| 数学|61 |31 || taro-1 | 一次試験| 国語|146 |73 || taro-1 | 試験2| 国語|200 |100 || taro-1 | 一次試験| 英語|199 |100 || taro-1 | 試験3| 英語|108 |54 || taro-1 | 一次試験| 化学|99 |99 |-- (割愛)ページ上の出力students_controllerのshowアクション編集参照: Active Record クエリインターフェイスapp/controllers/studetns_controller.rbdef show@students =Student.joins(:subjects).select('students.name, students.email, students.age, students.gender, students.opinion, subjects.id as subject_id').select('examresults.name as examresultname, subjects.name as subjectname, exam_results.score').select('CAST((examresults.score / subjects.maxscore) * 100 as unsigned) as ratio').where(id: params[:id])avg_result =Student.joins(:subjects).select('subjects.id as subject_id').select('CAST(AVG(examresults.score) as unsigned) as avgscore').select('MAX(examresults.score) as maxscore').select('MIN(examresults.score) as minscore').group('subjects.id').order('subjects.id')@score_hash = {}avgresult.each do |avgres|h = Hash.newh[:avgscore] = avgres.avg_scoreh[:maxscore] = avgres.max_scoreh[:minscore] = avgres.min_score@scorehash[avgres.subject_id] = hendendshowページのviewを編集app/views/students/show.html.erb科目名点数平均最高最小"
  },
  {
    "id": "20190318-read-ruby-reference",
    "title": "Qiita: Ruby リファレンスを読んだのでメモ",
    "create": "2019-03-18",
    "update": "2019-03-18",
    "tags": [
      "ruby"
    ],
    "content": "from Qiita: Rubyリファレンスを読んでの、メモ参照オブジェクト指向スクリプト言語 Ruby リファレンスマニュアル正規表現組み込みライブラリヒアドキュメント (行指向文字列リテラル)手続きオブジェクトの挙動の詳細Ruby用語集字句構造予約語エスケープ方法はあるが、使わない方が身のため。BEGINclassensurenilselfwhenENDdeffalsenotsuperwhilealiasdefined? fororthenyieldanddoifredotrueLINEbeginelseinrescueundefFILEbreakelsifmoduleretryunlessENCODINGcaseendnextreturnuntil変数と定数クラス変数@@@@で始まる変数はクラス変数親クラスに、子クラスで既に定義されている同名のクラス変数を追加したら、 子クラスのクラス変数が上書きされる。class Fooendclass Bar:fooend定数アルファベット大文字で始まる定義されている定数に代入を行おうとすると、警告を出すが、代入されるクラス定義の外(トッ プレベル)で定義された定数は Object に所属するあるクラスまたはモジュールで定義された定数を外部から参照する ためには::演算子を用いる。Objectクラスで定義の定数(トップレベルの定数と言う)を確実に参照するには左辺無し。module MI = 35class Cendendp M::I#=> 35p M::C#=> M::Cp ::M#=> MM::NewConst = 777# => 777リテラルバックスラッシュ記法文字列中でバックスラッシュの後に記述する文字によって、意味を持たせる事ができます。\\t　タブ(0x09)\\v　垂直タブ(0x0b)\\n　改行(0x0a)\\e　エスケープ (0x1b)\\s　空白 (0x20)\\nnn　8 進数表記 (n は 0-7)\\xnn　16 進数表記 (n は 0-9,a-f)%記法バックスラッシュの数をコードから減らす効果配列式では、文字列の配列やシンボルの配列を簡単に表現できる%!STRING! または　%Q!STRING!: ダブルクォート文字列%q!STRING! : シングルクォート文字列%w!STRING! : 要素が文字列の配列(空白区切り)%w(foo bar bazz) ['foo', 'bar', 'baz']%W!STRING! : 要素が文字列の配列(空白区切り)。式展開、バックスラッシュ記法が有効v = \"c d\"%W(a\\ b #{v}e\\sf #{})=> [\"a b\", \"c de f\", \"\"]%s!STRING! : シンボル。式展開、バックスラッシュ記法は無効%i!STRING! : 要素がシンボルの配列(空白区切り)%I!STRING! : 要素がシンボルの配列(空白区切り)。式展開、バックスラッシュ記法が有効演算子優先順位&& > || > and ora && b || c#=> (a && b) || ca || b && c#=>a || (b && c)再定義できない演算子 =?:.....not&&and||or::多重代入foo, bar = [1, 2]# foo = 1; bar = 2foo, bar = 1, 2# foo = 1; bar = 2foo, bar = 1# foo = 1; bar = nilfoo, bar, baz = 1, 2# foo = 1; bar = 2; baz = nilfoo, bar = 1, 2, 3# foo = 1; bar = 2foo= 1, 2, 3# foo = [1, 2, 3]*foo= 1, 2, 3# foo = [1, 2, 3]foo,*bar = 1, 2, 3# foo = 1; bar = [2, 3]左辺の最後の式の直前に * がついていると、対応する 左辺のない余った要素が配列として代入&&と||&&左辺を評価し、結果が偽なら、その値(つまり nil か false) を返す。左辺の評価結果が真なら、右辺を評価しその結果を返す||左辺を評価し、結果が真なら、その値を返す。左辺の評価結果が偽なら、右辺を評価し その評価結果を返す。条件演算子式1 ? 式2 : 式3上と下は同じif 式1 then 式2 else 式3 end例x = 123456789x%3 == 0 if \"3x\" : \"hazure\"=> 3x制御構造unlessunlessはifと反対で、条件式が偽の時にthen以下の式を評価。elsifを指定できない。制御構造(ifなど)の修飾子式 if 式の様に、一行で書くやつ。右辺の条件が真/偽の時にに、左辺の式を評価してその結果を返す。retryrescue 節で begin式からもう一度実行するのに使用。処理が成功するまで処理を繰り返すようなループを作れる。begindo_something # exception raisedrescuehandles errorretry# restart from beginningendrescue 節以外で retry が用いられた場合にはSyntaxError`クラス/メソッドの定義呼び出し制限public : 制限なしprivate : 関数形式でしか呼び出せないprotected : ソッドを持つオブジェクトが selfであるコンテキストでのみ呼び出し可能。nitializeは定義する場所に関係なく常に privateclass Foodef foop caller.lastendprotected :fooendaliasメソッドあるいはグローバル変数に別名をつけます。メソッド名には識別子そのものかリテラル/シンボル を指定alias 新メソッド名 旧メソッド名alias 新グローバル変数名 旧グローバル変数名alias foo baralias :foo :baralias $MATCH $&undef メソッド名メソッドの定義を取り消すdefined? 式式が定義されていなければ、偽を返す。定義されていれば式の種別を表す文字列を返す"
  },
  {
    "id": "20190317-manipulate-student-data",
    "title": "Qiita: 9, 10, 11, 14日目：大学生データ操作 App",
    "create": "2019-03-17",
    "update": "2019-12-04",
    "tags": [
      "mysql",
      "rails",
      "ruby"
    ],
    "content": "from Qiita9日目：大学生データ（マスターデータ10日目(1)：マスターデータ（DBへ情報入力、ページに出力11日目(1)、12日目：マスターデータ。ページUIの編集、ページャ導入14日目：Scaffoldで作成したサイトにgem devise等を組み合わせていく9日目rails newで動かない不具合stop springで解消ruby側で整数型をintと書き間違えることによるエラーrubyの整数型はintegermysqlはint (C++経験上、intの方が馴染み深いrails db:migrateコマでのエラー中間テーブルを先に作ってしまった為。中間テーブルは主テーブルのid等参照するので、作成は一番後。最適なデータ型を選択できなかった不具合改善の中で、Vagrantfileで、使用できるRAMのサイズを8GBに変更Vagrantfileconfig.vm.provider \"virtualbox\" do |vbvb.memory = \"8192\"endEnvironment仮想環境OS: Ubuntu 18.04Ruby：2.51Rails:5.2.2作成データテーブルstudent (id, name,email, gender, age, opinion, updatedat, createdat)ExamResult (id, student, subject, name, score, updatedat, createdat)中間テーブルSubject (id, name, maxscore, updatedat, created_at)※教科の意ClubStudent (id, student, club, name, updatedat, createdat)中間テーブルClub (id, name, updatedat, createdat)テーブル同士の関連性準備rails newrails new self_univ -d mysqlGemfilegem 'mini_racer', platforms: :rubybundle installqpp/config/database.ymlpassword:rails db:createscaffold(本段階scaffoldではcontrollerとmodelが同時に作成される)rubyの整数型はinteger中間テーブルは一番最後に作成中間テーブルのうち、主キーを参照するcolumnをreferenceで指定=> 自動で、bigintに設定されるrails g scaffoldrails generate scaffold Student name:string email:string gender:integer age:integer opinion:textrails generate scaffold Subject name:string max_score:integerrails generate scaffold Club name:stringrails generate scaffold ExamResult student:references subject:references name:string score:integerClubStudentテーブル（中間テーブルなので最後rails generate scaffold ClubStudent student:references club:references name:stringrails db:migrateテーブル同士の関連性を定義参照Active Record AssociationsActive Record の関連付けそれぞれのmodel.rbStudentモデルclass Student生徒データと関連付けするときはstudent1 = Student.firststudent1.clubs男性女性20代30代出力を考える学生ごとのshowページで表示したいもの生徒のデータ(name, mail, gender, age, opinion)生徒の教科ごとの試験結果点数性と全体の試験結果の平均点、最大点、最小点MySQL上の出力SELECTsubjects.name,CAST(AVG(examresults.score) as unsigned) as avgscore,MAX(examresults.score) as maxscore,MIN(examresults.score) as minscoreFROMstudentsINNER JOIN exam_resultsON students.id = examresults.studentidINNER JOIN subjectsON examresults.subjectid = subjects.idGROUP BY subjects.id, subjects.name-- 出力結果+--------+--------------+-----------+-------+-------+| name| name| name| score | ratio |+--------+--------------+-----------+-------+-------+| taro-1 | 一次試験| 数学|181 |91 || taro-1 | 試験1| 数学|61 |31 || taro-1 | 一次試験| 国語|146 |73 || taro-1 | 試験2| 国語|200 |100 || taro-1 | 一次試験| 英語|199 |100 || taro-1 | 試験3| 英語|108 |54 || taro-1 | 一次試験| 化学|99 |99 |-- ...ページ上の出力students_controllerのshowアクション編集参照Active Record クエリインターフェイスapp/controllers/studetns_controller.rbdef show@students =Student.joins(:subjects).select('students.name, students.email, students.age, students.gender, students.opinion, subjects.id as subject_id').select('examresults.name as examresultname, subjects.name as subjectname, exam_results.score').select('CAST((examresults.score / subjects.maxscore) * 100 as unsigned) as ratio').where(id: params[:id])avg_result =Student.joins(:subjects).select('subjects.id as subject_id').select('CAST(AVG(examresults.score) as unsigned) as avgscore').select('MAX(examresults.score) as maxscore').select('MIN(examresults.score) as minscore').group('subjects.id').order('subjects.id')@score_hash = {}avgresult.each do |avgres|h = Hash.newh[:avgscore] = avgres.avg_scoreh[:maxscore] = avgres.max_scoreh[:minscore] = avgres.min_score@scorehash[avgres.subject_id] = hendendshowページのviewを編集app/views/students/show.html.erb科目名点数平均最高最小11日目今回の流れExamResultsのindexページのデータ出力を編集ExamRusultの新規作成ページのUIを変更gem kaminariでページャー追加(授業内では時間足らず）実段階modify index page※app/views/exam_results/show.html.erbも同様にやるapp/views/exam_results/index.html.erb編集前編集後newページにセレクトボックス参照: Action View Form Helpersapp/views/examresults/form.html.erbapp/controllers/examresultscontroller.rbbeforeaction :setstudents_subjects, only: [:new, :edit]def setstudentssubjects@students = Student.all.pluck(:name, :id)@subjects = Subject.all.pluck(:name, :id)end編集後ページャの導入(kaminari)インデックス表示データが、studentページは100行、ExamResultページは900行と、見づらい.なので、studentとExamResultのindexページを、数ページに区切って表示させたい。今回はgemのkaminariを用いる。参照：kaminari -githubkaminariのインストールGemfilegem 'kaminari'bundle installstudentのindexページから変更indexアクションを編集app/controllers/students_controller.rbdef index編集前：@students = Student.all@students = Student.page(params[:page]).per(20)endviewを編集app/views/students/index.html.erbファイル先頭行に追加ファイル最終行に追加ExamResultのindexページ編集app/controllers/examresultcontroller.rbのindexアクションとapp/view/exam_results/index.html.erbを同様に編集ページャの見た目を変えるrails g kaminari:views default実行結果createapp/views/kaminari/nextpage.html.erbcreateapp/views/kaminari/_gap.html.erbcreateapp/views/kaminari/prevpage.html.erbcreateapp/views/kaminari/lastpage.html.erbcreateapp/views/kaminari/firstpage.html.erbcreateapp/views/kaminari/_paginator.html.erbcreateapp/views/kaminari/_page.html.erbページャの設定を変えるrails g kaminari:config#実行結果createconfig/initializers/kaminari_config.rbここで作成されたファイルに設定がある。Bootstrap対応のページャテーマもある.amatsuda/kaminari_themesconfig/initializers/kaminari_config.rbfrozenstringliteral: trueKaminari.configure do |config|config.defaultperpage = 25config.maxperpage = nilconfig.window = 4config.outer_window = 0config.left = 0config.right = 0config.pagemethodname = :pageconfig.param_name = :pageconfig.paramsonfirst_page = falseend12日目kaminariの別のファイル設定modelsにpaginates_per 30と記述controllerのindexアクションの末尾にある、per()を削除(ビューファイルは同じ)exam_resultも編集は同じ。app/models/student.rbpaginates_per 30app/controllers/students_controller.rb@students = Student.page(params[:page])app/views/students/index.html.erbファイル先頭ファイル末尾studentのindexページに、exam_resultのnewへのリンク作成リンクを作成app/views/student/index.html.erbapp/controllers/examresultscontroller.rbdef newif params[:student_id]@student = Student.find(params[:student_id])@selected_student = [@student.name, @student.id]end@exam_result = ExamResult.newendapp/views/examresult/form.html.erbstudentのindexから'New Exam Result'リンクを押すと、exam_resultのnewページに飛び、フォームのセレクトボタンのうち、生徒が自動で選択されるようになった。14日目今週からは、scaffoldで作成した大学データと、gemのdevise、Bootstrap等を組み合わせる。What I didRailsの命名規則(単数形と複数形)DBのカラム定義を後から変更render partial: 部分テンプレの参照validationUNSIGNEDという型が存在しないPostgreSQLRailsの命名規則(単数形と複数形)rails gコマンドで、controller名やmodel名を指定する際に、混乱した。rails generate scaffold model名の単数形　フィールド名の型と並びrails g controller controller名の複数形カラムの追加rails generate migration AddカラムToモデル名の複数形 フィールド名と並びmodel名は単数形で、頭文字を大文字にするscaffoldの場合、modelが基準modelは設計書であり、（テーブル1つに付き）1つなためcontroller名は複数形で、頭文字を大文字にする。1つのcontrollerに複数のactionが含まれるためDBのカラム定義を後から変更rails g scaffoldコマンド時に、ClubStudentの外部キーの定義をreferecesとミスタイプしていた。db/migrate/20190326030303createclub_students.rbclass CreateClubStudents'shared/header' %>表示させたいリンクを書きこむ。/app/views/shared/_header.html.erbvalidation参照: Active Record Validationsバリデーションは有効なデータだけをDBに保存するのを確実にするための最善策。validate条件空でないことvalidates :name, presence: true因みに、空が条件ならばvalidates :name, absence: true#入力文字の長さ文字の最大長は、データ型を要参照。varcharなら255文字まで2文字以上validates :name, length:{minimum:2}255文字以上validates :name, length:{maximum:255}exclusion含まないvalidates :name, exclusion: { in: %w(部 サークル) }『含む』ならinclusion空白や文字列長、『サークル』という語には、validatesが発動するが、『テニスサークル』だと発動しないので、正規表現等を使う必要がある。type \"unsigned\" does not exist (※Postgresql)validatesの実装していく最中に、エラーに気づいたstudentのeditページで更新すると、ActiveRecord::StatementInvalid in StudentsController#showPG::UndefinedObject: ERROR: type \"unsigned\" does not exist LINE 1: ...id as subjectid, CAST(AVG(examresults.score) as unsigned) ... ^ : SELECT subjects.id as subjectid, CAST(AVG(examresults.score) as unsigned) as avgscore, MAX(examresults.score) as maxscore, MIN(examresults.score) as minscore FROM \"students\" INNER JOIN \"examresults\" ON \"examresults\".\"studentid\" = \"students\".\"id\" INNER JOIN \"subjects\" ON \"subjects\".\"id\" = \"examresults\".\"subjectid\" GROUP BY subjects.id ORDER BY subjects.idと、エラーを吐き、因みに、ブラウザの戻るボタンで戻ると、更新されている。また、エラー原因であると思わる、StudentController#showはapp/controllers/students_controller.rbdef show@students =Student.joins(:subjects).select('students.name, students.email, students.age, students.gender, students.opinion, subjects.id as subject_id').select('examresults.name as examresultname, subjects.name as subjectname, exam_results.score').select('CAST((examresults.score / subjects.maxscore) * 100 as unsigned) as ratio').where(id: params[:id])avg_result =Student.joins(:subjects).select('subjects.id as subject_id').select('CAST(AVG(examresults.score) as unsigned) as avgscore').select('MAX(examresults.score) as maxscore').select('MIN(examresults.score) as minscore').group('subjects.id').order('subjects.id')(以下略)因みに、このcontrollerは、以前の大学データのcontrollerからコピーしてきたものだ。つまり、MySQLで動くアプリのcontroller。unsigned　(MySQL)MySQLにおいては正と負の整数を扱うことができる。unsignedを指定すると、正の数しか格納できなくなり、代わりに範囲が2倍になる。unsignedにした値が負になると、エラーを起こすUNSIGNEDは、マイナス値が入らないだけでなく、マイナスになる計算もできない。CASTで一時的に型を変える事で回避は可能。Postgresqlにはunsined型は存在しない(最重要)対応策まだ、試験結果のデータを入れてないので、功を奏すか分からないけれどもunsignedをint等の型に置き換える今回は試験点数を扱っていて、intで事足りると思われる。ただ、MySQLでint unsignedだと、範囲が正の方向に2倍になっている。扱う数によっては、intより1つ上ののbigintに変える必要があるCAST as unsignedの部分を消すMySQLでCAST as unsingedは、一時的に型を指定している前回の大学データに倣って、今回はcast as intに変更したapp/controllers/students_controller.rb(該当部分だけ抜き出し）.select('CAST((examresults.score / subjects.maxscore) * 100 as int) as ratio').select('CAST(AVG(examresults.score) as int) as avgscore')正常に、studentデータのedit、updateが機能した。データ入力にはpassword情報が必要deviseの関係上、パスワード情報入りのデータでないと、コンソールから入力できない。passwordカラムの追加deviseのモデル等がある、Studentテーブルに、パスワードカラムを追加した。rails generate migration AddカラムToモデル名の複数形 フィールド名と並びrails g migration AddPasswordToStudents password:stringdb/migrate下にファイルが生成される/db/migrate/20190327144825addpasswordtostudents.rbclass AddPasswordToStudents < ActiveRecord::Migration[5.2]def changeadd_column :students, :password, :integerendendこれで、パスワード情報入りの生徒データをDBに入力できる。input data未だデータの無い、生徒データと試験結果データをコンソールで入力した。(1..100).each do |num|if num % 2 == 0 && num % 3 ==0gen = 0ag = 1elsif num % 2 == 0gen = rand(2)ag = rand(3)elsegen = 1ag = 0endop = (1..10).map{('あ'..'わ').to_a[rand(26)]}.joinnm = (1..3).map{('あ'..'わ').to_a[rand(26)]}.joinuser = Student.create!(name: \"#{nm}\", email: \"#{nm}-#{rand(98)}@gmail.com\", gender: gen, age: ag, opinion: op,password: 'password')end(1..100).each do |i|student = Student.find(i)1.upto(rand(0..4)) dostudent.clubs << Club.find(rand(1..14))student.saveendend`"
  },
  {
    "id": "20190313-manipulate-mysql",
    "title": "Qiita: 6,7日目： MySQL 操作",
    "create": "2019-03-13",
    "update": "2019-12-04",
    "tags": [
      "mysql"
    ],
    "content": "from Qiita:6日目：MySQL操作7日目(1)：MySQLの操作今日の授業は、Railsを使わず、MySQLのみでデータ入力、操作する内容でした。テーブル同士の関係Associationbelong_to : 1対1の関係(例)　examresult(試験点数) belongto studentとある教科の試験の点数は、特定の1人の生徒に帰属has many : 1対多の関係(例)　student has many exam_result生徒は複数の試験を受けるので。many to many :多対多の関係(例)学生と部活の関係。学生は複数の部活に所属し、1つの部活には複数の学生が所属。当然、まったく所属していない学生も居る可能性がある| 生徒 | 部活１ | 部活２ | 部活３ | 部活4 ||:-:|:-:|:-:|:-:|:-:|| Aさん| 自転車部| 軽音部| 水泳部| バスケ部|| Bさん|||||| Cさん| 茶道部| 華道部| 水泳部 ||| Dさん |茶道部|軽音部|||多対多テーブルの問題DB上では1つのカラムに複数のデータは入れることが出来ない。上の表では、同義のカラム（部活１、部活2．。。）を増やしているが、データベースでは、これを2次元で表現することができない解決法：中間テーブル(/関連テーブル)、まず、生徒と部活にIDを持たせる| 生徒 | 生徒ID ||:-:|:-:|| Aさん| 1|| Bさん| 2|| Cさん| 3|| Dさん| 4|| 部活 | 部活ID ||:-:|:-:|| 自転車部| 1|| 茶道部| 2|| 水泳部| 3|...中間テーブル| 生徒ID | 部活ID ||:-:|:-:|| 1| 1|| 1| 3|| 1| 4|...実際にDBで触るときは、生徒テーブルと中間テーブルをJOINし、さらに中間テーブルと部活テーブルをJOINする使うデータデータベース: univ生徒テーブル: studentsname, grade, email, age, gender, others, createdat, updatedat試験結果テーブル: exam_resultsname, studentid, score, maxscore, createdat, updatedat本題：MySQL操作 CREATE DATABASEデータベース作成CREATE DATABASE データベース名;CREATE DATABASE univ;CREATE TABLE-- テーブル名は複数形で。-- CREATE TABLE students(カラム名　データ型　その他指定, カラム名　データ型　その他指定, ...);CREATE TABLE students(id INT NOT NULL PRIMARY KEYAUTO_INCREMENT,name VARCHAR(255) NOT NULL,grade INT(128) NOT NULL,email VARCHAR(255) NOT NULL,age INT(128) NOT NULL,gender INT(128) NOT NULL,others TEXT,createdat TIMESTAMP NOT NULL DEFAULT CURRENTTIMESTAMP,updatedat TIMESTAMP NOT NULL DEFAULT CURRENTTIMESTAMP)ENGINE=InnoDB DEFAULT CHARSET=utf8;バッククォートとシングルクォートバッククォート：テーブル名に使うシングルクォート：データの文字列に使う但し、バッククォートは必須ではないバッククォートよって、テーブル名やカラム名で使用できないように指定されている予約語（Reserved Words）を使えるようにできる。が、使わない方が良い。参照：phpMyAdminのSQLに付加される「'」に似た記号「`」は何？PRIMARY KEY、AUTO_INCREMENTPRIMARY KEY主キーの意。なお、外部キーはforeign keyAUTO_INCREMENT値が指定しないと、自動的にシーケンス番号を割り当てられる。整数型で、1ずつ増加し連番。MySQLのデータ型INT : 整数型（他にも、TINYINT < SMALLINT < MEDIUMINT < INT < BIGINTCHAR : 文字型（似たようなのには、VARCHARがある。）TIMESTAMP : 日付時刻型（'YYYY-MM-DD HH:MM:SS'）入力するデータ量に従って、最適なデータ型を選んだ方が、色々と良いようだ。参照：MySQL 5.6 リファレンスマニュアル/データ型DESC :テーブル情報の確認(Describeの略DESC students;-- 結果+------------+--------------+------+-----+-------------------+----------------+| Field| Type| Null | Key | Default| Extra|+------------+--------------+------+-----+-------------------+----------------+| id| int(11)| NO| PRI | NULL| auto_increment || name| varchar(255) | NO|| NULL||| grade| int(128)| NO|| NULL||| email| varchar(255) | NO|| NULL||| age| int(128)| NO|| NULL||| gender| int(128)| NO|| NULL||| others| text| YES|| NULL||| createdat | timestamp| NO|| CURRENTTIMESTAMP ||| updatedat | timestamp| NO|| CURRENTTIMESTAMP ||+------------+--------------+------+-----+-------------------+----------------+同様に、exam_resultsテーブルも作成CREATE TABLE exam_results (id int(11) NOT NULL AUTO_INCREMENT,　student_id int(11) NOT NULL,name varchar(255) NOT NULL,score int(128) NOT NULL,max_score int(128) NOT NULL,createdat timestamp NOT NULL DEFAULT CURRENTTIMESTAMP,updatedat timestamp NOT NULL DEFAULT CURRENTTIMESTAMP,PRIMARY KEY (id)) ENGINE=InnoDB AUTO_INCREMENT=7 DEFAULT CHARSET=utf8DESC subjects;-- 結果DESC exam_results;+------------+--------------+------+-----+-------------------+----------------+| Field| Type| Null | Key | Default| Extra|+------------+--------------+------+-----+-------------------+----------------+| id| int(11)| NO| PRI | NULL| auto_increment || student_id | int(11)| NO|| NULL||| name| varchar(255) | NO|| NULL||| score| int(128)| NO|| NULL||| max_score| int(128)| NO|| NULL||| createdat | timestamp| NO|| CURRENTTIMESTAMP ||| updatedat | timestamp| NO|| CURRENTTIMESTAMP ||+------------+--------------+------+-----+-------------------+----------------+ALTER TABLE :カラム変更ALTER TABLE テーブル名 ADD COLUMN カラム名 カラム定義,DROP COLUMN カラム名,CHANGE COLUMN 変えるカラム名 新しいカラム名 カラム定義,MODIFY COLUMN カラム名 新しいカラム定義;INSERT INTO :データ追加-- INSERT INTO テーブル名 (カラム1, カラム2, カラム3, ...)VALUE (カラム1データ, カラム2データ, カラム3データ, ...),(カラム1データ, ........);-- students生徒テーブルINSERT INTO students (name, grade,email, age, gender, others, createdat, updatedat ) value('taro',1, 'taro@email',23,0,'nothing_special',NOW(),NOW()), ('oriver',3, 'oriver@email',25,1,'別に',NOW(),NOW()),('yuki',1, 'jo@gmail.com', 20, 1, 'こんにちは、備考です。', now(), now());-- SELECT * FROM tables;で見る+----+--------+-------+--------------+-----+--------+-----------------------------------+---------------------+---------------------+| id | name| grade | email| age | gender | others| createdat| updatedat|+----+--------+-------+--------------+-----+--------+-----------------------------------+---------------------+---------------------+| 14 | taro|1 | taro@email|23 |0 | nothing_special| 2019-03-12 22:58:04 | 2019-03-12 22:58:04 || 15 | oriver |3 | oriver@email |25 |1 | 別に| 2019-03-12 22:58:04 | 2019-03-12 22:58:04 || 16 | yuki|1 | jo@gmail.com |20 |1 | こんにちは、備考です。| 2019-03-12 22:58:04 | 2019-03-12 22:58:04 |+----+--------+-------+--------------+-----+--------+-----------------------------------+--- exam_results試験結果テーブルINSERT INTO examresults (studentid,name, score, maxscore, createdat, updated_at ) value(14,'育種学',65,100,NOW(),NOW()),(14,'技術者倫理',70,100,NOW(),NOW()),(14,'農業機械',89,100,NOW(),NOW()),(14,'植物病理学',91,100,NOW(),NOW()),(14,'応用昆虫学',66,100,NOW(),NOW()),(15,'育種学',83,100,NOW(),NOW()),(15,'技術者倫理',74,100,NOW(),NOW()),(15,'農業機械',56,100,NOW(),NOW()),(15,'植物病理学',45,100,NOW(),NOW()),(15,'応用昆虫学',72,100,NOW(),NOW()),(16,'育種学',72,100,NOW(),NOW()),(16,'技術者倫理',83,100,NOW(),NOW()),(16,'農業機械',69,100,NOW(),NOW()),(16,'植物病理学',99,100,NOW(),NOW()),(16,'応用昆虫学',69,100,NOW(),NOW());-- 結果+----+------------+-----------------+-------+-----------+---------------------+---------------------+| id | studentid | name| score | maxscore | createdat| updatedat|+----+------------+-----------------+-------+-----------+---------------------+---------------------+| 51 |14 | 育種学|65 |100 | 2019-03-12 23:01:58 | 2019-03-12 23:01:58 || 52 |14 | 技術者倫理|70 |100 | 2019-03-12 23:01:58 | 2019-03-12 23:01:58 || 53 |14 | 農業機械|89 |100 | 2019-03-12 23:01:58 | 2019-03-12 23:01:58 || 54 |14 | 植物病理学|91 |100 | 2019-03-12 23:01:58 | 2019-03-12 23:01:58 |-- ...UPDATE SET WHERE:テーブル情報の更新今の時点では、max_scoreが100点だが、200点満点に変更してみる-- UPDATE テーブル名 SET カラム名 = 新しい情報 WHERE 条件UPDATE examresults SET maxscore = 200;結果+----+------------+-----------------+-------+-----------+---------------------+---------------------+| id | studentid | name| score | maxscore | createdat| updatedat|+----+------------+-----------------+-------+-----------+---------------------+---------------------+| 51 |14 | 育種学|65 |200 | 2019-03-12 23:01:58 | 2019-03-12 23:01:58 || 52 |14 | 技術者倫理|70 |200 | 2019-03-12 23:01:58 | 2019-03-12 23:01:58 || 53 |14 | 農業機械|89 |200 | 2019-03-12 23:01:58 | 2019-03-12 23:01:58 || 54 |14 | 植物病理学|91 |200 | 2019-03-12 23:01:58 | 2019-03-12 2-- ...JOIN :複数テーブル結合基本構文SELECT table1.column1, table1.column2table2,column1FROM table1INNER JOIN table2ON table1.primarykey = table2.foreignkeyINNER JOIN と　OUTER JOININNER JOIN : 内部結合の意。主キー＝外部キーになるところだけ表示結合できなかったレコードは表示しないouter join :外部結合結合できなかったレコードは、NULLで表示LEFT JOIN :主キー側のテーブルに合わせて表示RIGHT JOIN :外部キー側のテーブルに合わせて表示INNER JOINで結合してみるstudents生徒テーブルとexam_results試験結果の、主キーと外部キーを使って結合SELECT students.name, students.grade, students.gender,examresults.name, examresults.scoreFROM studentsINNER JOIN exam_resultsON students.id = examresults.studentid;-- 結果+--------+-------+--------+-----------------+-------+| name| grade | gender | name| score |+--------+-------+--------+-----------------+-------+| taro|1 |0 | 育種学|65 || taro|1 |0 | 技術者倫理|70 || taro|1 |0 | 農業機械|89 || taro|1 |0 | 植物病理学|91 || taro|1 |0 | 応用昆虫学|66 || oriver |3 |1 | 育種学|83 |-- ...データ削除テーブル情報の削除-- DELETE FROM テーブル名 WHERE 条件;DELETE FROM students;DELETE FROM exam_results;テーブルの削除-- DROP TABLE テーブル名;DROP TABLE students;DROP TABLE exam_results;データベースの削除-- DROP DATABASE データベース名;DROP DATABASE univ;7日目データベースとテーブル作成、データ追加データベース作成CREATE DATABASE univ1;テーブル作成USE univ1_development;-- 生徒テーブル作成CREATE TABLE students (id int(11) NOT NULL AUTO_INCREMENT,name varchar(255) NOT NULL,grade int(128) NOT NULL,email varchar(255) NOT NULL,age int(128) NOT NULL,gender int(128) NOT NULL,others text,createdat timestamp NOT NULL DEFAULT CURRENTTIMESTAMP,updatedat timestamp NOT NULL DEFAULT CURRENTTIMESTAMP,PRIMARY KEY (id))-- 生徒テーブルにデータ追加INSERT INTO students (name, grade, email, age, gender, others, createdat, updatedat) VALUE ('じょじ',1, 'jo@gmail.com', 20, 0, 'こんにちは、備考です。', now(), now()),('yuka',2, 'yuka@email', 22, 1,'特に',now(),now()),('なつこ',1, 'natsu@email', 28, 1,'夏来たれ',now(),now()), ('おりば',3,'oriver@email',23,0,'nothing',now(),now()),('masaya',2,'masaya@email',20,0,'nothing',now(),now());-- 試験結果テーブル作成CREATE TABLE exam_results (id int(11) NOT NULL AUTO_INCREMENT,student_id int(11) NOT NULL,name varchar(255) NOT NULL,score int(128) NOT NULL,max_score int(128) NOT NULL,createdat timestamp NOT NULL DEFAULT CURRENTTIMESTAMP,updatedat timestamp NOT NULL DEFAULT CURRENTTIMESTAMP,PRIMARY KEY (id))-- 試験結果テーブルにデータ追加INSERT INTO examresults (name, studentid, score, maxscore, createdat, updated_at) VALUE('物理', 12, 85, 100, now(), now()), ('数学', 12 ,64, 100, now(), now()), ('化学', 12 ,55, 100, now(), now()),('物理',13 ,85, 100, now(), now()), ('数学',13 ,65, 100, now(), now()), ('化学',13, 71, 100, now(), now()),('物理',14 ,88, 100, now(), now()), ('数学',14 ,73, 100, now(), now()), ('化学',14, 67, 100, now(), now()),('物理',15 ,100, 100, now(), now()), ('数学',15 ,92, 100, now(), now()), ('化学',15, 99, 100, now(), now()),('物理',16 ,30, 100, now(), now()), ('数学',16 ,43, 100, now(), now()), ('化学',16, 99, 100, now(), now());-- 部活テーブル作成CREATE TABLE clubs (id int(11) NOT NULL AUTO_INCREMENT,name varchar(255) NOT NULL,createdat timestamp NOT NULL DEFAULT CURRENTTIMESTAMP,updatedat timestamp NOT NULL DEFAULT CURRENTTIMESTAMP,PRIMARY KEY (id))-- 部活テーブルにデータ追加INSERT INTO clubs (name, createdat, updatedat) VALUE('サッカー', now(), now()),('野球', now(), now()),('囲碁', now(), now()),('空手', now(), now()),('合気道', now(), now()),('自転車',now(),now()),('軽音',now(),now());-- 生徒ー部活関連テーブル作成CREATE TABLE club_students (id int(11) NOT NULL AUTO_INCREMENT,student_id int(11) NOT NULL,club_id int(11) NOT NULL,createdat timestamp NOT NULL DEFAULT CURRENTTIMESTAMP,updatedat timestamp NOT NULL DEFAULT CURRENTTIMESTAMP,PRIMARY KEY (id))-- 生徒ー部活関連テーブルへデータ追加INSERT INTO clubstudents (studentid, clubid, createdat, updated_at) VALUE(12, 1, now(), now()),(12, 3, now(), now()),(12, 5, now(), now()),(12, 7, now(), now());INSERT INTO clubstudents (studentid, clubid, createdat, updated_at) VALUE(13, 2, now(), now()),(13, 4, now(), now()),(13, 6, now(), now());INSERT INTO clubstudents (studentid, clubid, createdat, updated_at) VALUE(14, 1, now(), now()),(14, 3, now(), now()),(14, 4, now(), now()),(14, 5, now(), now());INSERT INTO clubstudents (studentid, clubid, createdat, updated_at) VALUE(15, 4, now(), now()),(15, 5, now(), now()),(15 ,6, now(), now()),(15, 4, now(), now());本題：MySQL操作scoreの最高、最小、平均、(score / max_score)の最大値SELECT MAX(score),MIN(score),AVG(score),MAX(score/max_score)FROM exam_results;-- 結果+------------+------------+------------+----------------------+| MAX(score) | MIN(score) | AVG(score) | MAX(score/max_score) |+------------+------------+------------+----------------------+|100 |30 |74.4000 |1.0000 |+------------+------------+------------+----------------------+GROUP BY科目毎の最大値、最小値、平均値を求め、名前を最大、最小、平均に変更SELECT name,MAX(score) as 最大 , MIN(score) as 最小,AVG(score) as 平均FROM exam_resultsGROUP BY name;-- 結果+--------+--------+--------+---------+| name| 最大| 最小| 平均|+--------+--------+--------+---------+| 化学|99 |55 | 78.2000 || 数学|92 |43 | 67.4000 || 物理|100 |30 | 77.6000 |+--------+--------+--------+---------+INNER JOINstudentsとexam_resultsを結合し、生徒毎の、最高得点、最少得点、平均得点を出力SELECT students.name, MAX(score), MIN(score), AVG(score)FROM studentsINNER JOIN exam_resultsON students.id = examresults.studentidGROUP BY students.name;-- 結果+-----------+------------+------------+------------+| name| MAX(score) | MIN(score) | AVG(score) |+-----------+------------+------------+------------+| masaya|99 |30 |57.3333 || yuka|85 |65 |73.6667 || おりば|100 |92 |97.0000 || じょじ|85 |55 |68.0000 || なつこ|88 |67 |76.0000 |+-----------+------------+------------+------------+CASE WHEN条件分岐NULLがあったら、出力上の表記を変えるSELECTstudents.name,students.age,CASE WHEN clubs.name IS NOT NULL THEN clubs.nameELSE '無所属' end as club_nameFROMstudentsLEFT JOIN club_studentsON students.id = clubstudents.studentidLEFT JOIN clubsON clubstudents.clubid = clubs.id;-- 結果+-----------+-----+--------------+| name| age | club_name|+-----------+-----+--------------+| じょじ|20 | サッカー|| じょじ|20 | 囲碁|| じょじ|20 | 合気道|| じょじ|20 | 軽音|| yuka|22 | 野球|-- ...-- INNER JOINの場合、masayaのレコード自体が表示されない。部活ごとに、男性と女性それぞれ何人所属しているか、出力せよSELECTclubs.name,SUM(CASE WHEN students.gender = 0 THEN 1 ELSE 0 END) as male,SUM(CASE WHEN students.gender = 1 THEN 1 ELSE 0 END) as femaleFROMclubsLEFT JOIN club_studentsON clubs.id = clubstudents.clubidLEFT JOIN studentsON clubstudents.studentid = students.idGROUP BY clubs.name`"
  },
  {
    "id": "20190311-what-bootstrap",
    "title": "Qiita: 5日目： Bootstrap を初めて触ってみた",
    "create": "2019-03-11",
    "update": "2019-12-04",
    "tags": [
      "bootstrap",
      "rails",
      "ruby"
    ],
    "content": "from Qiita：Bootstrapを初めて触ってみたEnvironment仮想環境OS: Ubuntu 18.04ruby 2.5.1p57Rails 5.2.2MySQLWhat is Bootstrap> Bootstrapホームページトップより>>Build responsive, mobile-first projects on the web with the world’s most popular front-end component library.Bootstrap is an open source toolkit for developing with HTML, CSS, and JS. Quickly prototype your ideas or build your entire app with our Sass variables and mixins, responsive grid system, extensive prebuilt components, and powerful plugins built on jQuery.preparation till rails srails new private_butostrap -d mysql#Gemfileのmini-racerコメントインbundle install/config/database.ymlのパスワード情報追加rails db:createrails s# 一応確認Scaffoldでテーブル作成rails g scaffold (コントローラ名/モデル名)　カラム名：データ型　・・・rails g scaffold User name:string email:string sex:integer age:integer address:integer attendance:integer opinion:textrails db:migraterails db:migrate一応確認としてuse privatebutostrapdevelopment;show table;consoleでデータ追加(1..100).each do |num|if num % 2 == 0s = 0ad = 0at = 0elses = 1ad = 1at = 1enduser = User.create(name: \"taro-#{num}\", email: \"val-#{num}@gmail.com\", sex: s, address: ad, attendance: at, opinion: \"nothing special-#{num}\")user.saveendBootstrapで見栄え修正ButostrapのCSSの読み込み参照: Bootstrap introductionの中で読み込む -->の中で読み込む -->リンクが青くなった。indexページのNewUserボタンの変更app/views/users/index.html.erb元のコードBootstrap用のclass追加同様にshow、edit、destroyボタンも変更tableの見栄えも変更参照bootstrap tableapp/views/layouts/application.html.erb元のコード修正後jsファイルの挿入部分を考える授業の中で言われたことheadかbodyどうかが、ユーザビリティに影響を与えるhead内：jsファイルが重い場合は、jsファイルが読み込まれるまで、ページが表示されない。body内：先にページが表示されて、その後にjsファイルが読み込まれます。HTML解析前に実行されるべきjsファイルなどはheadタグ内に記述するべしページ読み込み時間は、ユーザの直帰率等に影響を及ぼす参照: 一次データ:Does Page Load Time Really Affect Bounce Rate? pingdom上の一次データによると、ページ読み込み時間3秒までは直帰率は10%弱だが、5秒で38%、7秒で50%を超えるサイトページをいかに軽し、見せたいものの読み込み速度を上げることは重要"
  },
  {
    "id": "20190311-httpmethod-crud-sql",
    "title": "Qiita: 3日目(2)：HTTP メソッドと CRUD と SQL",
    "create": "2019-03-11",
    "update": "",
    "tags": [
      "crud",
      "http",
      "restful",
      "sql"
    ],
    "content": "from Qiita: HTTPメソッドとCRUDとSQLflow to display web pageブラウザでURLにアクセスして、DNSサーバーにIPを問い合わせ、DNSサーバーがIPを返すhtmlなどの情報をやり取りするためのProtocol Cliantがサーバー上のquery(何を)とHttpメソッド(行いたい処理）をサーバーにHttpリクエストする。サーバーがレスポンスHTTPHypertext Transfer Protocolの略HTMLとXMLによるHypertextの送信を主に、その他様々なデータのやり取りができる。リクエスト-レスポンス型のプロトコルで、webブラウザ「あれが欲しい。これをしてくれ」(※あれ＝query、これをして＝http method)webサーバ「OK、はいよ」HTTPメソッドの内訳とSQLの関係、CRUDとRESTful|HTTPメソッド| 内容 | CRUD|MYSql| MySQL||:-:|:-:|:-:|:-:|:-:||GET| リソース取得 | CREATE| 生成| INSERT ||POST| リソースデータ追加、小リソース作成 | READ | 読み取り | SELECT ||PUT/PATCH| リソース更新作成| UPDATE| 更新 | UPDATE ||DELETE| リソース削除 | DELETE| 削除 | DELETE ||:-:|:-:|| HEAD | リソースのヘッダ(メタデータ取得)|| OPTION | リソースがサポートしているメソッドの取得|| TRACE | プロキシ動作の確保|| CONNECT | プロキシ動作のトンネル接続への変更|CRUDCREATE, READ, UPDATE, DELETEの4つの単語のイニシャルを並べたもの上４つは、殆ど全てのコンピュータソフトが持つ永続性の基本機能（情報の参照。検索。更新。削除）ここでいう永続性とは専門的な意味合いなので、wikiだけでも読むと面白いREST分散ハイパーメディアシステムのためのソフトウェアアーキテクチャのスタイルのひとつ。HTTP規格の主要著者のロイ・フィールディングが2000年に初めて提唱参照: Architectural Styles and the Design of Network-based Software Architectureswikipedia「Representational State Transfer」よりフィールディングのRESTアーキテクチャスタイルの原則に合わせたWebサービスシステム。遠隔手続き呼出し(RPC)スタイルに合わせた簡易なXML + HTTPインタフェースを採用したシステム"
  },
  {
    "id": "20190316-ruby-exam",
    "title": "Qiita: 2,4,7,8,13日目： Ruby 認定試験による勉強",
    "create": "2019-03-06",
    "update": "2019-03-24",
    "tags": [
      "ruby"
    ],
    "content": "from Qiita:2日目(1)：Ruby認定試験による確認4日目(2)：Ruby認定試験による勉強7日目(2)：Ruby認定試験による勉強8日目(2)：Ruby認定試験13日目(2)：Ruby認定試験ソースコードの文字コードをUS-ASCIIに設定のマジックコメント1. coding: us-ascii2. encoding: us-ascii3. -- charset: us-ascii --4. CODING: US-ASCII1，2，4は同義で、正解。3はPython。例外処理（begin rescue ensure endWikipediaによると>プログラムの上位の処理から呼び出されている下位の処理で継続不能、または継続すれば支障をきたす異常事態に陥ったとき、制御を呼び出し元の上位の処理に返し安全な状態になるよう回復処理をすること。begin例外が起こりうるコード1rescue => # 変数(例外オブジェクトの代入)例外が起きた場合のコード2ensure例外の有無に関わらず、実行するコード3end1で例外が起きなかったら、表示結果は1且つ3の表示結果、起きた場合は2且つ3の表示結果となる。例外処理コードとして、ensureが用いられないパターンもある。その他、rescueの中でretryを用い、beginが成功するまで繰り返す処理がる。(無限ループ注意）定数と変数下コードの実行結果は『10と表示された後、警告が表示され100と表示される。』MAX=10print MAXMAX=100print MAXRubyにおいて、アルファベット大文字から始まる識別子(ABCやAbc)は定数である。他言語では定数を再定義しようとすると、警告が出て、結果、再定義できない。Rubyにおいては、警告が出たのち、そのままデータがオーバーライトされる可変長引数def foo(*a)p aendfoo(1,2,3)#実行結果　[1,2,3]*を1個付けると、引数を複数指定でき、引数は配列として受け取られる。*を2個付けると、オプション引数となり、Hashとして受け取られる。範囲オブジェクトとeach.to_i文字列を10進数の表現と見なして整数に変換します。#引数baseを取ることもでき、その引数で何進数かを示す。#デフォルト値は10であり、引数指定しない場合は10進数となる。変数.to_i(2)範囲オブジェクトdef hogex = 0(1...5).each do |i|x += 1endputs xendhoge#実行結果　4まず『数A...数B』に関して、これはAからBまで繰り返すの意。ただし、Bは含まれない。そのため、『1...5』は、1から4までの4回分繰り返す。一方で、『1..5』は5を含み、1から5までの5回分繰り返す。因みに、『1..5』『101..105』『2001..2005』だろうと5回分。uptomoney = 1000オブジェクト.upto(max) do |i|実行処理endmoney = 1001.upto(3) do |i|money = money * 1.1endputs money.to_iuptoメソッドは、変数に「対象オブジェクトが持つ数値」から「max」までを順に代入しながら、処理実行。1回繰り返す毎に1ずつ数値は増加します。（ここでは１から３までの3回。『1..3』と同義。また、downtoメソッドもあり、これは1回繰り返すごとに1ずつ数値が減少する。timesメソッドも参照すべしstepオブジェクト.step(limit, stepno) do |変数|実行する処理1実行する処理2endはじめに、stemnoを『数値間隔』とするとわかりやすい。対象オブジェクトを持つ数字から順に代入しながら、処理を実行。1回繰り返すごとに、stepnoで指定した数値間隔ごとに、数値が増加する。範囲オブジェクト、uptoメソッドまとめmoney = 1000rate = 1.12001.upto(2004) do |i|money = money * rateputs \"I got #{money.to_i} in #{i}.\"end#実行結果I got 1100 in 2001.I got 1210 in 2002.I got 1331 in 2003.I got 1464 in 2004.これは、下とも書けるmoney = 1000rate = 1.1(2001..2004).each do |i|money *= rateputs \"I got #{money.to_i} in #{i}.\"end4日目変数、定数いろいろローカル変数アルファベット小文字または`_'で始まる識別子グローバル変数$で始まり、宣言が必要なく、プログラムのどこからでも参照できる。初期化されていないグローバル変数を参照した場合、値はnil。インスタンス変数@で始まり、特定の オブジェクトに属する。そのクラスま たはサブクラスのメソッドから参照できます。初期化されていないインスタンス変数を参照した場合、値はnil。クラス変数@@で始まり、クラス定義 の中で定義されるクラスの特異メソッド、インスタンスメソッドなどから参照／代入ができる。定数アルファベット大文字で始まる。他の言語では『定数』なので、再定義しようとしても、警告が出て、再定義できない。Rubyでは、再定義しようとすると、警告が出るが、再定義できてしまう。super親クラスのメソッドを呼び出すclass Userattr_accessor:saydef initialize@say = \"Hello\"endendclass Oriver演算子式](https://docs.ruby-lang.org/ja/latest/doc/spec=2foperator.html)Ruby の場合、演算子の多くがただのメソッドとして定義。再定義できる演算子|^&======~>>=>-*/%**~+@-@[][]=` ! != !~再定義不可の演算子演算子の組合せである自己代入演算子は再定義できない。=?:.....not&&and||or::演算子の定義方法参照: Ruby 2.6.0 リファレンスマニュアル > クラス／メソッドの定義；演算子式の定義二項演算子def +(other)# obj + otherdef -(other)# obj - other単項プラス/マイナスdef +@# +objdef -@# -obj要素代入def foo=(value)# obj.foo = value[] と []=def# obj[key]def []=(key, value)# obj[key] = valuedef []=(key, key2, value)# obj[key, key2] = valueバッククォート記法def (arg)# arg` または %x(arg)メソッドのオーバーライドと比較演算子##比較演算子と otherreturn self.idother.idend比較演算子| 1 | 2 ||:-:|:-:|| ab| 1|| 比較不可|nil |[1, 3, 5]#find_all[1, 2, 3, 4, 5].find_all{ |v| v % 2 == 1 }=> [1, 3, 5]map と　collect同じ動作をし、条件にある配列をtrue or falseで出力#map[1, 2, 3, 4, 5].map{ |v| v % 2 == 1 }=> [true, false, true, false, true]#collect[1, 2, 3, 4, 5].collect{ |v| v % 2 == 1 }=> [true, false, true, false, true]findfindは先頭要素だけ出力#find[1, 2, 3, 4, 5].find{ |v| v % 2 == 1 }=> 1破壊的メソッドconcatconcat!は定義されていないval = [ \"a\", \"b\" ]c=> [\"a\", \"b\"]val.concat( [\"c\", \"d\"] ) #=> [ \"a\", \"b\", \"c\", \"d\" ]=> [\"a\", \"b\", \"c\", \"d\"]lputs valabcd最後、valの値が変化している所、、要注意zip[array]コード結果を選べa1=%w(a b)a2=%w(x y)a3=a1.zip(a2)p a3.first選択肢\"a\",2. [\"a\"],3. [\"a\", \"x\"],4. [\"a\", \"b\"],5. 例外が発生する。解答%w( )配列を作る。配列の要素はスペース区切りで指定する。式の展開はされない。zip array> instance method Array#zip>> zipメソッドは、配列の要素を引数の配列other_arrayの要素と組み合わせ、配列の配列を作成して返します。行と列を入れ替えるが、足りない要素はnilで埋められ、余分な要素は捨てられます。arr1 = [1, 2, 3]arr2 = [4, 5]arr3 = [6, 7, 8, 9]p arr1.zip(arr2, arr3)[[1, 4, 6], [2, 5, 7], [3, nil, 8]]slice()実行結果をかけa = [1,2,3,4,5]p a.slice(1,3)#答えslice()要参照sliceメソッドは、[]メソッドの別名です。配列から引数で指定した位置の要素を取り出して返す。equal実行結果を書けa = \"abc\"b = \"abc\"print a.eql? bprint a.equal? bprint a == b答えtruefalsetrueeql?ハッシュの内部で「同じキーかどうか」を調べるために使われるメソッド.今回は、レシーバabcが引数abcと同じかどうか調べている##eqal?(object)レシーバobjと引数other_objが同じオブジェクトならtrue、別のオブジェクトならfalseを返す。objent絡みなので、変数名が違うと、falseを返すのだろう。。。？型の取り扱い：エラーにならないものを選べputs 5 + \"Hello\",2. puts \"Hello\" + 5puts \"Hello\" * 5,4. puts 5 * \"Hello\"答えintegerとstring勘違いしていた例えば、puts hoge + \"ほげ\"であっても、hogeが整数型の変数なら、hogeほげと返すconcatとchopとchomp：実行結果を書けs1 = \"Hoge\"s2 = \"Fuga\"s1.concat(s2)s1.chops1.chomps1 + s2puts s1答えconcat破壊的メソッド。 \"HogeFuga\"chopでs1末尾のeが取り除かれるs1.chop=> \"HogeFug\"s1に改行文字は含まれていないs1.chomp=> \"HogeFuga\"文字型同士の和は可能s1 + s2=> \"HogeFugaFuga\"concatの破壊的性質により、s1.concat(s2)の時点で、s1がHogeFugaに。puts s1HogeFuga[]メソッドs = \"123456789\"p s[1,4]解答\"2345\"まず、範囲オブジェクトの類だと思っていた。要参照: [] (Array)slice()の別名Hashクラス選択肢{}で空のHashオブジェクトを生成できる。[]で空のHashオブジェクトを生成できる。invertでキーと値を入れ替えることができる。keyに対応する値を取り出すメソッドとして、haskey?(key)、key?(key)、get key(key)などが用意されている。すべての要素を削除するには、delete_allを使用する。#答え３と２(答えを忘れた。後でまた調べるHashクラスハッシュオブジェクトの元になっているクラス[][]メソッドは、配列から引数で指定した位置の要素を取り出して返します。引数には、整数（位置）、整数2つ（位置と数）、範囲を指定できます。{}Hash作成invertキーを値に、値をキーにしたハッシュを作成keyhas_key?メソッドは、ハッシュが引数keyと同じキーを持っていればtrue、なければfalseを返します。key?メソッド、include?, member?メソッドは、has_key?の別名delete_all検索でdelete hashはヒットするが、delete_all hash はヒットしないHashクラス適切でないものを選べ選択肢1, deleteはキーを指定してキーと値の組を削除する。2, removeはキーと値の組を削除する。3, fetchは与えられたキーに関連付けられた値を返す。4, clearはハッシュの要素を全て削除する。#答え１と４deleteハッシュから引数keyと同じキーを探して、キーと値を削除。レシーバ自身を変更するメソッドです。fetchハッシュから引数で指定したキーの値を取り出して返します。[]メソッドと機能は同じ.だが、キーが存在しないときの動作が異なるclearキーと値をすべて削除し、ハッシュを空にします。レシーバ自身を変更するメソッドです。Hashクラス実行結果をかけ#{} の問題v = {}v.class#出力答え　HashHashクラス実行結果をかけ#invert array : 問題v = {:v1 => 1, :v2 => v}v.invert#出力答え　{1=>:v1, nil=>:v2}invert既に上で記述済み%等々回答を選択しから選べmember = [10, \"Tanaka\"]print \"ID:%2d Name:%s\" #ここに代入する式を選択して下さい。member実行結果ID:10 Name:Tanaka選択肢,,2. +%,4. .format#答え　%%dと%s,%%d数字を文字列にしているsprintf(\"%d\", 4);=> \"4\"%2d 2桁の文字列を返すsprintf(\"%2d\", 4);=> \" 4\"%02d 2桁の文字列を返す。桁数が足りない場合は、前に0を追加。sprintf(\"%02d\", 4);=> \"04\"%sシンボル:を付ける。式の展開はされない。Hashクラス適切な選択肢を#配列、シンボル　問題h = #ここに代入する式を選択して下さい。p h#選択肢{a:1,b:2,c:3}、2. {a=1,b=2,c=3}Hash[:a, 1, :b, 2, :c, 3]、4. {:a1,:b2,:c3}#実行結果{ :a => 1, :b => 2, :c => 3 }#答え　４8日目ioクラス実行結果をファイルdataの内容はabcdefgFile.open(\"data\") do |io|while not io.eof?print io.read(1)io.seek(0,IO::SEEK_SET)endend#答え: aが表示され続けるCPUが6割、メモリ６GB食われてたので、ちょっと焦りました。EOFとはEnd of Fileの略##ioクラスメソッド、SEEK_SET> instance method IO#seek>> ファイルポインタを whence の位置から offset だけ移動させます。 offset 位置への移動が成功すれば 0 を返しますファイル上の文字にポインタなる住所のようで住所じゃないものがある。らしい今回は、io.seek(0,IO::SEEK_SET)でオフセットを0に指定しているため、文字の読み込みが最初のaからすすまない（ずっとaが読み込まれる）らしいstrgtime実行結果にあう、選択肢を選べ問題t = Time.gm(1970,1,1)puts t.strftime(\"#ここに代入する式を選択\")=> 1970/01/01#選択肢1, %y/%m/%d,2, %Y/%M/%d3, %y/%M/%d,4, %Y/%m/%d#答え：4strgtimeメソッドinstance method Time#strftimestrgtimeで代表的なもの| 1 | 2 | 3 | 4 | 5 | 6 | 7 ||:-:|:-:|:-:|:-:|:-:|:-:|:-:||4桁の西暦 | 2桁の西暦| 月| 日| 時刻| 分| 秒|| %Y| %y| %m|%d |%H | %M|%S |正規表現Newまたはnewのみで構成される行にマッチする正規表現を選びなさい。（二つ選択選択肢^[Nn]ew$^N|new$^Nn[w]$^New|new$^[New]|[new]$#答え　１と３Rubyの予約語予約語を選べ問題whilerandgotoclassconst#答え　whileとclass予約語: 既にruby側で定義されている言葉。自分で使おうとしても使えない。to_s実行結果をかけ問題x = 0[1,2,3].each do |x| print x.to_s + \" \"endputs x#解答　12301，2，3は表示上は数字型だか、実は文字型to_s　：整数型データを文字型に変換する検証コードx = 0[1,2,3].each do |x|print x.to_s + \" \"print x.to_s.classendputs x実行結果irb(main):001:0> x = 0=> 01irb(main):002:0> [1,2,3].each do |x| irb(main):003:1*print x.to_s + \" \"irb(main):004:1>print x.to_s.classirb(main):005:1> o_s.classirb(main):005:1> endirb(main):005:1> end1 String2 String3 String=> [1, 2, 3]irb(main):006:0> puts x0=> nilRubyの偽の値#問題nil0\"\"false0.0NULL#解答nil とfalse例外処理: 適切な選択肢を問題y = falsey ##AAA## (raise \"failed\")puts(\"succeeded!\")#選択肢1, |,2, ||,3, &,4, &&#答え&&&&演算子&&演算子は左辺の評価結果がfalseの場合は、右辺を評価せずに次の処理に進む|| 演算子は、左辺の評価結果がtrue の場合は、右辺を評価せずに次の処理に進む|演算子と&演算子は、左辺の評価結果に関係なく、右辺を評価するraise 例外raiseは例外を投げるので、それ以降の処理を飛ばすそれを捕捉したい場合は、begin rescue endを使う今回の場合、raiseが実行されるとputs(\"succeeded!\")が実行されないのを、考慮範囲オブジェクト1から10まで表示sるコードを選べ(1.10).each do |i| puts i end(1..10).each do |i| puts i end(1...10).each do |i| puts i end(1....10).each do |i| puts i end#答え　２範囲オブジェクト定義されているのは、点２つと点3つ。２つは２から10以下　、3つは２から10未満gsub!実行するとどうなる問題HOGE = \"hoge\"HOGE.gsub!(\"hoge\", \"piyo\")print HOGE答え警告は発生せず、「piyo」が表示される。gsub! :破壊的メソッドアルファベット大文字で始まる識別子は定数は定数なので、新たに代入を行う際には警告が発生します。しかし、gsub!は破壊的メソッドを呼び出しているだけなので、警告は発生せず、文字列は「piyo」に書き換わります。例外正しい記述を選べ問題beginによって例外を捕捉する際は、例外の可能性がある処理をbeginからrescueの間に記述する。ひとつの処理に対して複数のrescueは、指定できない。例外オブジェクトのメソッドstacktraceにより、例外スタックを取得できる。ensureは、必ず記述する必要があるA. １stacktraceとは> stack trace - 「分かりそう」で「分からない」でも「分かった」気になれるIT用語辞典>> エラーが発生したときに表示される内容で、そのエラーが発生するまでの過程（どんな処理がどの順番で呼び出されたかの流れ）を、ざっくりと表示したものエラーコード以下のコードの##AAA##にZeroDivisionError が発生した時の処理を記述したい。適切なコードを選択問題beginputs 10 / 0 #ZeroDivisionError##AAAprint \"ZeroDivisionException:\", ex.messageend#選択肢rescue ZeroDivisionError = exrescue ZeroDivisionError exrescue ZeroDivisionError -> ex4 rescue ZeroDivisionError => ex#答え　3試してみてbeginputs \"hello\"puts 10 / 0puts \"good afternoon\"puts \"good afternoon\"puts \"good afternoon\"puts \"good afternoon\"puts \"good afternoon\"puts \"good afternoon\"rescue ZeroDivisionError => exputs \"good bye\"print \"ZeroDivisionException:\", ex.messageendbeginputs \"hello\"puts 10 / 0puts \"good afternoon\"puts \"good afternoon\"puts \"good afternoon\"puts \"good afternoon\"puts \"good afternoon\"puts \"good afternoon\"rescue Exception => exputs \"good bye1111111\"print \"message:\", ex.messagerescue ZeroDivisionError => exputs \"good bye2222222\"print \"ZeroDivisionException:\", ex.messageend参照: Ruby 例外について?Aコード実行どうなる問題p ?A#答え　\"A\"解説#コード１p \"A\".ord=> 65#コード２p 65.chr#=> \"A\"65とはunicode上のAの番号的な参照: Ruby にて文字と Unicode コードポイントの相互変換を行う13日目クラスの継承エラーにならないものを選べclass Hoge Module全てのクラスから参照できるメソッドを定義しているモジュール。Objectクラスはこのモジュールをインクルードしています。Objectクラスのメソッドは実際にはこのモジュールで定義されています。to_i(n)to_iメソッドは、文字列をn進数の表現と見なして整数に変換。文字列の先頭から10進数と見なせる部分を切り取って変換し、見なせる部分がなければ0を返す。p \"12abc\".to_i =>123p \"abc12\".to_i =>0p \"ab12c\".to_i =>0p \"1abc2\".to_i =>`1正規表現s = \"a;b:c;d:e;f\"p s.split (/:|;/)=>[\"a\", \"b\", \"c\", \"d\", \"e\", \"f\"]配列と範囲オブジェクトいつも、ごちゃごちゃになる。a=[1,2,3,4]a[1,3]=> [2,3,4]a[1..3]=> [2,3,4]a[1...3]=> [2,3]a[1....3] => errora[2..-1]=> [3,4]範囲オブジェクトは文字列にも使えるa=\"abcdefghijk\"a[1,3] = \"x\"p a =>\"axefghijk\"a[1..3] = \"x\"p a =>\"axefghijk\"a[1...3] = \"x\"p a =>\"axdefghijl\"&と&&、|と||a = [1,2,3,4]b = [1,3,5,7]p a & b =>[1, 3]p a && b =>[1, 3, 5, 7]p a | b =>[1, 2, 3, 4, 5, 7]p a || b =>[1, 2, 3, 4]| 1 | 作用 ||:-:|:-:|| &| 日本語の”且つ”と同じ。|| &&|左辺が真なら、右辺を評価して、右辺を返す || パイプ1本 |日本語の”又は”と同じ || パイプ2本 | 左辺が真なら、右辺を評価せずに、左辺を返す|※パイプ＝『|』。エスケープできなかった可変長引数def sum (##AAA##)total = 0a.each {|i| total += i }return totalendputs sum(1, 2, 3, 4, 5)=>15delete_if = reject!　破壊的メソッドブロックの戻り値が真になった要素を削除。なお、rejectは非破壊的a= [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]a.delete_if{|v| v % 2 == 0 }=>[1, 3, 5, 7, 9]p a => [1, 3, 5, 7, 9]enum.eachwithindex {|item, idx| block }繰り返しごとにブロック引数itemには各要素が入り、idxには0，1，2と番号が入るa = [\"apple\", \"orange\", \"grape\", \"pine\"]a.eachwithindex{ |item, i| print i, \":\", item, \"\\n\" }=>0:apple1:orange2:grape3:pinearray.each_index {|index| block }『ほぼ』eachwithindexと同じ繰り返しごとにブロック引数には各要素のインデックス（位置）の整数が入ります。戻り値はレシーバ自身hash.each_pair {|key, val| block }eachと同じhash.each_key {|key| block }繰り返しごとにブロック引数keyにはキーが入る。hash.each_value {|val| block }繰り返しごとにブロック引数valにはキーの値が入る。each_何たらが他にも結構あるので、見ておこうshift とunshift 破壊的メソッドshiftメソッドは、配列の最初の要素を削除し、その要素を返します。レシーバ自身を変更するメソッドです。配列が空のときはnilを返します。s = [\"one\",\"two\",\"three\"]s.shift=> \"one\" ※先頭のoneを削除s.shift=> \"two\"　※先頭のtwoを削除s.unshift=> [\"three\"]　※引数が無いので、何もしてないs.push \"four\"=> [\"three\", \"four\"]p s=>[\"three\", \"four\"]compactとuniqa = [:a,:a,:b,:c]a[5] = :ea.concat([:a,:b,:c])a.compacta.uniqp a=> [:a, :a, :b, :c, nil, :e, :a, :b, :c]concat, compact, uniqのうち、破壊的メソッドはconcatのみなので、結果、元の配列aに影響を及ぼすのはconcatのみconcat 破壊的　= push =[2, 4, 6, 8, 10, 12]a.inject {|v| v * 2}=> 32a.each {|v| v * 2}=> [1, 2, 3, 4, 5, 6]a.map {|v| v * 2}=>[2, 4, 6, 8, 10, 12]a.select {|v| v * 2}=> [1, 2, 3, 4, 5, 6]a.execute {|v| v * 2}=> errorundefined methodどうしたらinjectが32になるか、リファレンス見ても理解できない%w記法配列を作るsarray = %w(Apple Orange Grape)sarray.each {|v| print v, \" \"}Apple Orange Grapezip実行結果になるように、##AAA##に記述するコードを選んで下さいa = [\"a\", \"b\", \"c\"]b = [1, 2, 3]##AAA#実行結果[\"a\", 1][\"b\", 2][\"c\", 3]#選択肢a.zip(b).each{|x| p x }a.zip(b){|x| p x }[a, b].zip{|x, y| p [x, y] }[a, b].transpose.each{|x, y| p [x, y] }#答え　1，2，4zip行と列を入れ替える。足りない要素はnilを返すtransposezipと同様、行と列を入れ替える。要素が足りない場合、例外IndexErrorを発生。EOB以下のコードは正しく動きません。修正案を。s =nilchop 非破壊的文字列の末尾から1文字を取り除いた新しい文字列を返す!が付くと、破壊的chomp 非破壊的文字列の末尾の改行文字を取り除いた新しい文字列を返す！が付くと、破壊的^ キャレット名をキャレット、否定をするputs \"0123456789-\".delete(\"^13-56-\")=> 13456-13456-に該当『しない』ものを削除している正規表現p \"abc def 123 ghi 456\".scan(/\\d+/).length=> 2\\dは10進数なので、10進数から始まる部分を配列で返し(scan)、その要素の数lengthを返してるscan(string)指定した正規表現のパターンとマッチする部分を文字列からすべて取り出し、配列にして返す。p \"HogeHOGEhoge\"[/[A-Z]+/]=> \"Hoge\"大文字と小文字のアルファベットで構成される文字列を返しているinvert(hash)hashのキーと値を入れ替えるh = {1 => \"Hoge\", 2=> \"Piyo\", 3=>\"fuga\"}p h.invert{“Hoge”=>1, “Piyo”=>2,“fuga”=>3 }update と　sorta = {\"Foo\" => \"Hoge\", \"Bar\" => \"Piyo\", \"Baz\" => \"Fuga\"}b = {\"Foo\" => \"hoge\", \"Bar\" => \"piyo\", \"Baz\" => \"fuga\"}p a.update(b).sort{ |a, b| a[1]b[1] }[[\"Baz\", \"fuga\"], [\"Foo\", \"hoge\"], [\"Bar\", \"piyo\"]]updateわかりづらいsort配列の要素をソートした新しい配列を返します。「要素1要素2」の結果が-1なら要素1が先、0なら同じ、1なら要素2が先となります。ルート以下のコードは、ファイル test . txt を読み、文字を逆順に書き込む処理です。「##AAA##」に入る適切な記述を選びなさい。open(\"test.txt\",\"##AAA##\") do |f|data = f.read.chompdata.reverse!f.rewindf.write dataend#選択肢awra+r+w+組み込み関数openの第2引数には、ファイルのオープン モードを指定します。r、w、a に + を付けると、読み書き 両用でオープンします。w+ を指定すると元ファイルの内 容を空にします。a+ を指定すると、追記モードとなり、 元のファイルを書き換えることができません。chr と ord は対義語的puts 65.chr=> \"A\"puts \"a\".ord=> 97コードポイントの話。n.chrは,nで登録されている文字を返すstring.ordはstringのコードポイントを返すメソッドの意味は覚えてるけど、もう『65を見たらA』と覚えるしか。securerandom Module安全な乱数発生器のためのインターフェースを提供するモジュールrequire 'securerandom'SecureRandom.urlsafe_base64urlsafe_base64ランダムで URL-safe な base64 文字列を生成して返します。"
  },
  {
    "id": "20190306-without-scaffold",
    "title": "Qiita: 2日目(2)：Scaffold なしでの掲示板作成",
    "create": "2019-03-06",
    "update": "2019-12-04",
    "tags": [
      "rails",
      "ruby",
      "ubuntu"
    ],
    "content": "from Qiita:2日目(2)：Scaffoldを用いた掲示板作成3日目：ScaffoldなしでのApp作成4日目：Scaffold無しでフォーム作成：ModelとView8日目(1)：Scaffoldなしの掲示板作成：まとめ使用環境仮想環境OS: Ubuntu 18.04Ruby：2.51Rails:5.2.2rails db:migrateRailsドキュメントより(http://railsdoc.com/references/rake%20db:migrate)rails db:migrateを実行schema_migrationsテーブルを調べ、存在しなければ作成db/migrateディレクトリ内のすべてのマイグレーションファイルを調べるデータベースの現在のバージョンと異なるバージョンがあった場合、データベースに適応schema_migrationsテーブルの更新3日目scaffoldを利用せずにApp作成をし、Scaffoldの有難みを知る前準備rails s new qiita_routes -d mysqlGemfileのminiracerコメントインして、bundle installconfig/database.ymlのpassword情報編集rails db:create前提：知識ページ作成に必要なものview(@ /app/views/コントローラ名/今日はしなかったので、今投稿には未記載viewの中身がブラウザに表示される内容controller(コントローラページ表示の際、controllerを経由して、viewをブラウザに返す。controllerで設定したactionは、controllerと同じ名前のviewフォルダの中から、actionと同じ名前のhtmlファイルを探してブラウザに返します（まだ理解しきれていない気がする。routing(ルーティングブラウザとcontrollerを繋ぐ。ページ表示の流れRouting => Controller => Model => Viewmodelはデータベース情報が必要な時だけ使用.今回は必要ではないので、とばす。本段階controllerを作成#rails generate controller コントローラ名 (+アクション名)rails generate controller Usersroutingの設定：ブラウザとコントローラをつなぐconfig/routes.rbRails.application.routes.draw doget 'users', action: :index, controller: 'users'endrails routesPrefix Verb URI PatternController#Actionusers GET/users(.:format)#追加された行users#index#追加された行controller：modelとviewをつなぐapp/controllers/users_controller.rbclass UsersController ということはcontroller作成コマンドは rails g controller コントローラ名　アクション名参照: Ruby on Rails でページを作成する仕組み by @np_misaki氏config : アプリケーションの設定情報を格納する/routes.rb : ルーティングの設定を行う/locales : 辞書ファイル(グローバル対応等)/app : アプリケーション開発中にメインで使用するディレクトリ/controllers..Controller クラスを格納する/models :　Modelクラスを格納する/views :View クラスを格納する4日目モデルを作成modelとはデータベースを操作する。app/models下に配置されるデータベースに含まれるテーブル毎に用意され、データの登録・取得・更新・削除などを行うmodel作成コマンドrails generate model モデル名 カラム名:データ型 カラム名:データ型 ...rails generate model User name:string email:string sex:integer age:integer address:integer attendance:integer opinion:textstring型は文字型、integer型は整数型DBの操作テーブルの作成をする。rails db:migrate出来たテーブルをMySQL側で確認してみる。-- mysqlUSE scanashi0307_development;-- Reading table information for completion of table and column names-- You can turn off this feature to get a quicker startup with -A-- Database changed-- mysql> SHOW TABLES;-- +------------------------------------+-- | Tablesinscanashi0307_development |-- +------------------------------------+-- | arinternalmetadata|-- | schema_migrations|-- | users|-- +------------------------------------+-- 3 rows in set (0.00 sec)-- usersテーブルが作成されたことが分かる。SHOW CREATE TABLE users;| users | CREATE TABLE users (id bigint(20) NOT NULL AUTO_INCREMENT,name varchar(255) DEFAULT NULL,email varchar(255) DEFAULT NULL,sex int(11) DEFAULT NULL,age int(11) DEFAULT NULL,address int(11) DEFAULT NULL,attendance int(11) DEFAULT NULL,opinion text,created_at datetime NOT NULL,updated_at datetime NOT NULL,PRIMARY KEY (id)) ENGINE=InnoDB DEFAULT CHARSET=utf8 |rails g modelsで設定したカラム名が作成されているのが分かる。データベースにfooさんのレコードを追加してみるINSERT INTO users (name, email, sex, age, address, attendance, opinion, createdat, updatedat) VALUES ('foo', 'foo@gmail.com', 1, 23, 2, 0, 'foooo', '2017-04-04 04:44:44', '2018-04-04 04:44:44');-- Query OK, 1 row affected (0.00 sec)MySQLの中から、追加されているレコードを確認してみる。SELECT * FROM users;-- +----+------+---------------+------+------+---------+------------+---------+---------------------+---------------------+-- | id | name | email| sex| age| address | attendance | opinion | createdat| updatedat|-- +----+------+---------------+------+------+---------+------------+---------+---------------------+---------------------+-- |1 | foo| foo@gmail.com |1 |23 |2 |0 | foooo| 2017-04-04 04:44:44 | 2018-04-04 04:44:44 |-- +----+------+---------------+------+------+---------+------------+---------+---------------------+---------------------+rails console から新たにレコードを追加する。user = User.create(name: \"taro\", email: \"val@gmail.com\", sex: 0, address: 1, attendance: 1, opinion: 'nothing special')#user.saveでDBに保存するuser.save=> trueRails Console上でレコード取得レコードの全てのユーザ情報を取得User.allレコードの全てののユーザ情報のうち、最後に追加したものを取得User.all.last最初に追加したユーザを取得して、データを削除first_user = User.all.firstfirst_user.destroyユーザ情報を変更user = User.all.first#最初に追加したユーザ情報を取得user.name = \"ichitaro\"#取得した最初のユーザ情報のうち、nameを\"ichitaro\"にオーバーライドuser.save#ユーザ情報を保存追加されているユーザ数をカウントUser.all.countカラムの値がXという条件に合致するユーザ情報を取得User.find_by(カラム:値)(.ex) User.find_by(id:2)controllerのアクションの整備app/controllers/users_controller.rbclass UsersControllerUsersNameEmailSexAgeAddressAttendanceOpinionapp/views/layouts/application.html.erb割愛ルーティングを変更app/config/routes.erbresources :usersrails routes実行 Prefix VerbURI Pattern Controller#Actionusers GET/users(.:format)users#indexPOST/users(.:format)users#createnew_user GET/users/new(.:format)users#newedit_user GET/users/:id/edit(.:format)users#edituser GET/users/:id(.:format)users#showPATCH/users/:id(.:format)users#updatePUT/users/:id(.:format)users#updateDELETE /users/:id(.:format)users#destroy...次に上にある、「users GET/users(.:format)users#index 」を実装UserControllerの中にshowアクションを作成app/controllers/users_controller.rbclass UsersController上はhtml上で Aに変化する。この時点でrails sで立ち上げるとshowアクションusers_pathはusers#indexへのリンクnewuserpathはusers#newへのリンクedituserpathはusers#editへのリンクuser_pathはusers#showへのリンクapp/views/users/show.html.erbName:Email:割愛 |show, edit アクションの定義app/controllers/users_controller.rbdef show@user = User.find params[:id]enddef edit@user = User.find(params[:id])endapp/views/users/edit.html.erbprohibited this @user from being saved:割愛追加：2日目を参考にし、表示を触ってみる。性別の値 0 or 1 を男性or女性で表示させる。app/models/user.rbclass Userラジオボタンに変更app/views/users/edit.html.erb男性女性同様に、年齢、住所、参加不参加もラジオボタンにしておく。レコードの中から、nameがfooであるユーザ情報を取得user = User.find_by(name:\"foo\")取得したユーザ情報のうち、ageを0にオーバーライドuser.age = 0ユーザ情報をDBに保存するuser.savefooさんの年齢が確認されたか、確認してみる。User.find_by(name: \"foo\")結果8日目users_controllerapp/controllers/uupdate.rbupdateアクションdef update@user = User.find params[:id]if @user.update(params.require(:user).permit(:name, :email, :sex, :age, :address, :attendance, :opinion))respond_to do |format|format.html { redirect_to @user, notice: 'User was successfully updated.' }endelserespond_to do |format|format.html { render :edit }endendenddestroyアクション定義def destroy@user = User.find params[:id]@user.destroyrespond_to do |format|format.html { redirectto usersurl, notice: 'User was successfully destroyed.' }endendnewアクション定義def new@user = User.newendindexページからのdestroyへのリンク作成app/views/users/index.html.erbnewページ編集app/views/users/new.html.erbNew Userprohibited this user from being saved:割愛indexからnewへのリンク作成app/views/users/index.html.erbcreateアクション定義app/controllers/users_controller.rbdef create@user = User.new(params.require(:user).permit(:name, :email, :sex, :age, :address, :attendance, :opinion))if @user.saverespond_to do |format|format.html { redirect_to @user, notice: 'User was successfully updated.' }endelserespond_to do |format|format.html { render :edit }endendendリファクタリング> wikipedia>> リファクタリング (refactoring) とは、コンピュータプログラミングにおいて、プログラムの外部から見た動作を変えずにソースコードの内部構造を整理することである。createアクションとupdateアクションの共通化2アクションに下の共通箇所があるapp/controllers/users_controller.rb@user = User.new(params.require(:user).permit(:name, :email, :sex, :age, :address, :attendance, :opinion))リファクタリング後app/controllers/users_controller.rbdef create@user = User.new(user_params)if @user.saverespond_to do |format|format.html { redirect_to @user, notice: 'User was successfully updated.' }endelserespond_to do |format|format.html { render :edit }endendenddef update@user = User.find params[:id]if @user.update(user_params)respond_to do |format|format.html { redirect_to @user, notice: 'User was successfully updated.' }endelserespond_to do |format|format.html { render :edit }endendendprivatedef user_paramsparams.require(:user).permit(:name, :email, :sex, :age, :address, :attendance, :opinion)endendshow. edit. updata, destroyの共通化app/controllers/users_controller.rb共通している部分@user = User.find params[:id]共通化した結果set_user追加def set_user@user = User.find params[:id]endbefore_action追加show, edit, update, destroyアクションの前に、必ず実行の意class UsersController"
  },
  {
    "id": "20190305-shellscript-permission",
    "title": "Qiita: 1日目  Linux と Shellscript と Permission",
    "create": "2019-03-05",
    "update": "2019-03-18",
    "tags": [
      "linux",
      "shellscript"
    ],
    "content": "fromQiita: 1日目 LinuxとShellscriptとPermissionLinuxメイン課題ディレクトリ1を作成ディレクトリ1の中にファイル1を作成ディレクトリ2を作成ディレクトリ2の中にディレクトリ3を作成ディレクトリ1をディレクトリ3の中に移動mkdir dir1touch dir1/file1mkdir -p dir2/dir3mv dir1 dir2/dir3コマンドのオプションが分からなくなった時man コマンド名今回使用したオプション付きコマンドmkdir -p-p, --parents　no error if existing, make parent directories as neededmv O1 O2O2が同ディレクトリ内に存在しないとき：リネームO2が同ディレクトリ内に存在するとき：移動rm -r-r, -R, --recursiveremove directories and their contents recursivelyrecursive：再帰的：ディレクトリ内のものに一つ一つに対し処理ls -lamanコマンドで調べると-la自体は無いが、-lと-aオプションが存在する。-a, --all do not ignore entries starting withすべてのファイルやディレクトリを表示する。 #この時、隠しフォルダや。から始まるディレクトリも表示される。-luse a long listing formatファイルの詳細を表示する。シェルスクリプトOSのシェルまたはコマンドラインインタプリタ向けに書かれたスクリプト言語。拡張子は.sh#シェルスクリプト作成touch test.sh#シェルスクリプト内編集(先の課題のコードを記述してみる。#!/bin/shmkdir dir1touch dir1/file1mkdir -p dir2/dir3mv dir1 dir2/dir31行目は『シバン』と呼ばれ、UNIXのスクリプトの#! から始まる1行目を指す。起動してスクリプトを読み込むインタプリタを指定する。インタプリタ（interpreter）とは、プログラミング言語で書かれたソースコードないし中間表現を逐次解釈しながら実行（英語版）するプログラムのこと。このtest.shを活用することで、先の課題を自動的に行うことができる。#起動方法./test.shPermissionls -la test.sh#表示結果-rw-rw-r-- 1 vagrant vagrant 0 Mar4 23:48 test.sh#左のチャンクから、user:所有者、usergroup:vagrant、others:誰でも、を意味する。#また、r＝read権限、w=write権限、ここでは見えないがx=execute権限(実行許可）を指す。chmod=change mode権限編集モードすべてのユーザーに実行権限を与える／禁止する。chmod +x test.sh　/ chmod -x test.sh#グループに書き込み権限をその他のユーザーには実行権限を禁止する。chmod g+w,o-x test.sh別の表示方法(数字）r、w、xにそれぞれ4，2，1を割り当て、表すことができる。rw-r--r--=>644r-xr--r--=>544#数字表示での権限編集#すべてのユーザーに書き込み権限と読込権限を与える。chmod 666 test.shPermissionとPermitの違いプログラムはPermissionどちらも名詞で『許可』を意味するが、ニュアンスが違う。日本語で説明するとズレるので、英英辞典で確認したい。あと、Permissionのスペル注意。"
  }
]