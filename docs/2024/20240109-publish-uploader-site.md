---
title: ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãƒ»ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã§ãã‚‹Webã‚¢ãƒ—ãƒªã‚’å…¬é–‹ã—ã¾ã—ãŸ
create: "2024-01-09"
update: "2024-01-09"
tags: [react, firebase]
description: "è¶£å‘³é ˜åŸŸã§é–‹ç™ºãƒ»ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã—ã¦ã„ã‚‹JSè£½ãƒ„ãƒ¼ãƒ«ã‚’é…å¸ƒã™ã‚‹ãŸã‚ã«ã€Reactã€Zodã€Firebaseãªã©ã‚’ä½¿ã£ã¦Webã‚¢ãƒ—ãƒªã‚’ä½œæˆã—ã¾ã—ãŸ"
published: true
---

ä»¥é™ã€ULï¼ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã€DLï¼ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã¨çœç•¥ã—ã¾ã™ã€‚

## ã¯ã˜ã‚ã«

è¶£å‘³é–¢ä¿‚ã§é–‹ç™ºãƒ»ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã—ã¦ã„ã‚‹ JS è£½ã®ãƒ„ãƒ¼ãƒ«ã‚’ GoogleDive ã§é…å¸ƒã—ã¦ã„ãŸã®ã§ã™ãŒã€ä»£æ›¿ã‚µãƒ¼ãƒ“ã‚¹ã‚’æ¢ã—ã¦ã„ã¾ã—ãŸã€‚æ¢ã™ä¸­ã§ä½œã‚Œãã†ã ãƒ»ä½œã£ã¦ã¿ãŸã„ã¨æ€ã„ã€2022å¹´8æœˆã«ã‚µã‚¤ãƒˆã‚’å…¬é–‹ã—ã¾ã—ãŸã€‚

â€»è‡ªãƒ„ãƒ¼ãƒ«é…å¸ƒã®ãŸã‚ã ã‘ã®ã‚µã‚¤ãƒˆã§ã‚ã‚Šã€ã¾ãŸæ‚ªæ„ã®ã‚ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä»–è€…ã« UL ã•ã‚Œã‚‹ã¨å›°ã‚‹ã®ã§ã€ã‚µã‚¤ãƒˆ URL ã¨ GitHub ãƒªãƒã‚¸ãƒˆãƒªã¯éå…¬é–‹ã§ã™ã€‚

### ã©ã‚“ãªã‚µãƒ¼ãƒ“ã‚¹

`.zip`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª¬æ˜æ–‡ã¨ã¨ã‚‚ã« UL ã—ã€ã¾ãŸ DL ã§ãã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã€‚UL ã«ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²ã‚’å¿…è¦ã¨ã—ã€DL ã¯éç™»éŒ²ãƒ¦ãƒ¼ã‚¶ãƒ¼ã§ã‚‚å¯èƒ½ã€‚

![Image from Gyazo](https://i.gyazo.com/ca3fe099cecbd3ae3190071178432e52.png)

`.zip`ãƒ•ã‚¡ã‚¤ãƒ«ã®ç¨®åˆ¥ã‚„ã‚µã‚¤ã‚ºã€æœ€çµ‚æ›´æ–°ã€ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æ•°ã€èª¬æ˜æ–‡ã‚’é–²è¦§ã§ãã‚‹ã€‚

![Image from Gyazo](https://i.gyazo.com/a196d0a42cc76e0bcdabbbb4658cde5a.png)

åˆ©ç”¨è¦ç´„ã«åŒæ„ã™ã‚‹ã¨ã€DL å¯èƒ½ã¨ãªã‚‹ã€‚

![Image from Gyazo](https://i.gyazo.com/506ba3da5f5e4b8cd6ca54f49423205b.png)

### åˆ©ç”¨çŠ¶æ³

åŸºæœ¬çš„ã«æœˆä¸Šæ—¬ã«1å›ã€ä¸å…·åˆãªã©ã‚ã‚Œã°ãƒã‚¤ãƒŠãƒ¼ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆç‰ˆã¨è¨€ã£ãŸé¢¨ã«ã—ã¦ã„ã¾ã™ã€‚â€»ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ãƒ»é–‹ç™ºã‚’å¼•ãç¶™ãå‰ã‹ã‚‰ã€æ—¥æ™‚ãƒ™ãƒ¼ã‚¹ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ã¨ãªã£ã¦ã„ã¾ã—ãŸã€‚

![Image from Gyazo](https://i.gyazo.com/ac6ea63d60e6b9ddb707f95bb9b1b9d8.png)

![Image from Gyazo](https://i.gyazo.com/f1e7e6c245d3f2cd161ec7157a855d41.png)

## é–‹ç™º

### åˆ©ç”¨ã—ãŸæŠ€è¡“ãƒ»ã‚µãƒ¼ãƒ“ã‚¹

ã‚µã‚¤ãƒˆãƒ‡ã‚¶ã‚¤ãƒ³ç­‰ã¯çœåŠ›åŒ–ã®ãŸã‚ã«[Tailwind CSS Components](https://tailwindcomponents.com/)ã‚’å‚ç…§ã—ã¾ã—ãŸã€‚

- React, TypeScript, TailwindCSS
  - [CSFrequency/react-firebase-hooks: React Hooks for Firebase.](https://github.com/CSFrequency/react-firebase-hooks)
  - [React Hook Form - Simple React forms validation](https://www.react-hook-form.com/)
    - [Zod | Documentation](https://zod.dev/)
    - [react-dropzone](https://react-dropzone.js.org/)
- [Firebase](https://firebase.google.com)
  - Hosting, Firestore Database, Storage

### Form components

`react-hook-form`ã‚’ä½¿ã„ã€`TextInput.tsx`, `PasswordInput.tsx`, `Textarea.tsx`, `Checkbox.tsx` ãªã©ã‚’ä½œæˆã—ã€signup ã‚„ login èªè¨¼ã‚„ãƒ•ã‚¡ã‚¤ãƒ« UL æ™‚ã®ãƒ•ã‚©ãƒ¼ãƒ ã§åˆ©ç”¨ã—ã¾ã—ãŸã€‚ã¾ãŸã€ãƒ•ã‚¡ã‚¤ãƒ« UL ã®ç‚ºã®ãƒ‰ãƒ­ãƒƒãƒ—ã‚¾ãƒ¼ãƒ³ã¯`react-dropzone`ã‚’åˆ©ç”¨ã—ã¾ã—ãŸãŒã€ã‚³ãƒ¼ãƒ‰ãŒé•·ã„ã®ã§å‰²æ„›ã—ã¾ã™ã€‚

<details>

<summary>PasswordInput.tsx</summary>

```typescript
import type { ComponentProps, FC } from "react";
import { useState, useCallback } from "react"
import { useFormContext } from "react-hook-form";
import { twMerge } from "tailwind-merge";
import { EyeIcon, EyeSlashIcon } from "@heroicons/react/24/outline";

export type InputProps = Omit<ComponentProps<"input">, "type"> & {
  id: string;
  label: string;
  validation?: RegisterOptions;
  helperText?: string;
};

export const PasswordInput: FC<InputProps> = (props) => {
  const { label, placeholder = "", helperText = "", id, disabled, readOnly, validation, ...rest } = props;

  const { register, formState: { errors } } = useFormContext();
  const [showPassword, setShowPassword] = useState(false);
  const togglePassword = useCallback(() => {
    setShowPassword((prev) => !prev);
  }, []);

  let stateClass;
  if (readOnly || disabled) {
    stateClass = "bg-gray-100 focus:ring-0 cursor-not-allowed border-gray-300 focus:border-gray-300";
  } else if (errors[id]) {
    stateClass = "focus:ring-red-500 border-red-500 focus:border-red-500";
  } else {
    stateClass = "focus:ring-primary-500 border-gray-300 focus:border-primary-500";
  }
  const className = twMerge("block w-full rounded-md shadow-sm", stateClass);
  const isError = !!Object.entries(errors).length && !!errors[id]

  return (
    <div>
      <label htmlFor={id} className="block text-sm font-normal text-gray-700">
        {label}
      </label>
      <div className="relative mt-1">
        <input
          {...register(id, validation)} {...rest}
          type={showPassword ? "text" : "password"}
          name={id} id={id}
          readOnly={readOnly} disabled={disabled}
          className={className} placeholder={placeholder} aria-describedby={id}
        />

        <button
          onClick={(e) => {
            e.preventDefault();
            togglePassword();
          }}
          type="button"
          className="focus:ring-primary-500 absolute inset-y-0 right-0 mr-3 flex items-center rounded-lg p-1 focus:outline-none focus:ring"
        >
          {showPassword ? (
            <EyeSlashIcon className="h-6 w-6 cursor-pointer text-gray-500 hover:text-gray-600" />
          ) : (
            <EyeIcon className="h-6 w-6 cursor-pointer text-gray-500 hover:text-gray-600" />
          )}
        </button>
      </div>
      <div className="mt-1">
        {helperText && <p className="text-xs text-gray-500">{helperText}</p>}
        {isError && <span className="text-sm text-red-500">{JSON.stringify(errors[id]?.message, null, 2)}</span>}
      </div>
    </div>
  );
};
```

</details>

### èªè¨¼æ©Ÿèƒ½

ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²ã‚’ç§ã®ã¿ã«åˆ¶é™ã™ã‚‹ãŸã‚ã«ã€ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ãƒ»ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã«ã‚ˆã‚‹ Firebase èªè¨¼ã‚’é¸æŠã—ã€`.env`ã§è¨­å®šã•ã‚ŒãŸãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã®ã¿ä½¿ãˆã‚‹ã‚ˆã†ã«ã—ã¾ã—ãŸã€‚

- [JavaScript ã§ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ ãƒ™ãƒ¼ã‚¹ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½¿ç”¨ã—ã¦ Firebase èªè¨¼ã‚’è¡Œã†](https://firebase.google.com/docs/auth/web/password-auth?hl=ja)

#### zod

ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã®ãŸã‚ã«`react-hook-form`ã®`zodResolver`ã‚’åˆ©ç”¨ã—ã¾ã—ãŸã€‚

- [react-hook-form/resolvers: ğŸ“‹ Validation resolvers: Yup, Zod, AJV, Joi, Superstruct, Vest, class-validator, io-ts, typanion, Ajv, TypeBox, Valibot and nope.](https://github.com/react-hook-form/resolvers#zod)

```typescript
import * from z from "zod";

const emailSchema = z
  .string()
  .email({ message: 'ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã®å½¢å¼ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“' });

const passwordSchema = z.string()

export const SignUpWithEmailAndPasswordSchema = z.object({
  email: emailSchema,
  password: passwordSchema
})
```

#### Signup

<details>

<summary>Signup.tsx</summary>

```typescript
import { FC, useEffect } from "react";
import { useNavigate } from "react-router-dom";
import { useCreateUserWithEmailAndPassword } from "react-firebase-hooks/auth";
import { FormProvider, useForm } from "react-hook-form";
import { z } from "zod";
import { zodResolver } from "@hookform/resolvers/zod";

import { auth } from "@/lib/firebase";
import { SignUpWithEmailAndPasswordSchema } from "@/lib/zod";
import { Input, PasswordInput, Button } from "@/components/Form";

const validEmail = import.meta.env.VITE_VALID_EMAIL_ADRESS;

const Signup: FC = () => {
  const navigate = useNavigate();
  const [createUserWithEmailAndPassword, user, loading, error] = useCreateUserWithEmailAndPassword(auth);
  const methods = useForm<z.infer<typeof SignUpWithEmailAndPasswordSchema>>({
    resolver: zodResolver(SignUpWithEmailAndPasswordSchema),
  });
  const { handleSubmit, setError } = methods;

  const onSubmit = handleSubmit((data) => {
    const { email, password } = data;
    if (email !== validEmail) {
      setError("email", { type: "custom", message: "ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¾ãŸã¯ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé–“é•ã£ã¦ã„ã¾ã™" });
      setError("password", { type: "custom", message: "ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¾ãŸã¯ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé–“é•ã£ã¦ã„ã¾ã™" });
      return;
    }

    createUserWithEmailAndPassword(email, password);
  });

  useEffect(() => {
    if (user) navigate("/admin");
  }, [user]);

  return (
    <FormProvider {...methods}>
      <form onSubmit={onSubmit} className="mx-auto max-w-lg rounded-lg border">
        <div className="flex flex-col gap-4 p-4 md:p-8">
          <Input id="email" label="Eãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹" placeholder="example@example.com" validation={{ required: "required" }} />
          <PasswordInput id="password" label="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰" validation={{ required: "required" }} />
          <Button type="submit">ã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ—</Button>
        </div>
      </form>
    </FormProvider>
  );
};

export default Signup;
```

</details>

### Firestore database

ãƒ•ã‚¡ã‚¤ãƒ« UL ã®éš›ã«è¿½åŠ æƒ…å ±ã¨ã—ã¦å…¥åŠ›ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã®èª¬æ˜æ–‡ã‚„ã‚µã‚¤ã‚ºã€contentType ãªã©ã‚’ä¿å­˜ã™ã‚‹å…ˆã¨ã—ã¦ã€Firestore ã‚’åˆ©ç”¨ã—ã¾ã—ãŸã€‚æœ¬æ¥ã§ã‚ã‚Œã° userID ãªã©ã‚’è¿½åŠ ã™ã¹ãã‹ã¨æ€ã„ã¾ã—ãŸãŒã€ç™»éŒ²å¯èƒ½ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ç§ã®ã¿ã«åˆ¶é™ã—ã¦ã„ã‚‹ã®ã§æ¥½ã‚’ã—ã¾ã—ãŸã€‚

```json
{
  "files": {
    "autoID": {
      "name": "hoge.zip",
      "description": "description",
      "downloaded": 133,
      "contentType": "application/x-zip-compressed",
      "path": "path-to-firebase-storage",
      "size": 579896,
      "createdAt": "serverTime",
      "updatedAt": "serverTime"
    }
  }
}
```

```plaintext
<!-- firestore.rules -->
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    function isAuthenticated() {
      return request.auth != null;
    }

    match /files/{fileID} {
      allow get, list, update;
      allow create, delete: if isAuthenticated()
    }
  }
}
```

### Storage

UL ã•ã‚ŒãŸ`.zip`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¿å­˜ã™ã‚‹ãŸã‚ã«åˆ©ç”¨ã—ã¾ã—ãŸã€‚

```plaintext
<!-- storage.rules -->
rules_version = '2';
service firebase.storage {
  function isAuthenticated() {
    return request.auth != null;
  }

  match /b/{bucket}/o {
    match /files/{fileID} {
      allow get;
      allow create, update, delete: if isAuthenticated()
    }
  }
}
```

#### CORS Error

Firebase Storage ã‚’åˆ©ç”¨ã™ã‚‹éš›ã«ã‚ãŸã£ã¦ã€CORS ã®è¨­å®šã‚’ã—ã¾ã—ãŸã€‚

> ãƒ–ãƒ©ã‚¦ã‚¶ã§ç›´æ¥ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ã«ã¯ã€Cloud Storage ãƒã‚±ãƒƒãƒˆã«å¯¾ã—ã¦ã‚¯ãƒ­ã‚¹ã‚ªãƒªã‚¸ãƒ³ ã‚¢ã‚¯ã‚»ã‚¹ï¼ˆCORSï¼‰ã‚’æ§‹æˆã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
> > ã‚¦ã‚§ãƒ–ã§ Cloud Storage ã‚’ä½¿ç”¨ã—ã¦ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹

- [ã‚¦ã‚§ãƒ–ã§ Cloud Storage ã‚’ä½¿ç”¨ã—ã¦ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ Â |Â  Cloud Storage for Firebase](https://firebase.google.com/docs/storage/web/download-files?hl=ja#cors_configuration)
- [ã‚¯ãƒ­ã‚¹ã‚ªãƒªã‚¸ãƒ³ ãƒªã‚½ãƒ¼ã‚¹ ã‚·ã‚§ã‚¢ãƒªãƒ³ã‚°ï¼ˆCORSï¼‰ã®æ§‹æˆ](https://cloud.google.com/storage/docs/configuring-cors?hl=ja)
- [gsutil ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ Â |Â  Cloud Storage Â |Â  Google Cloud](https://cloud.google.com/storage/docs/gsutil_install?hl=ja)

```json:cors.json
[
  {
    "origin": [
      "https://example.com",
      "http://localhost:3000"
    ],
    "responseHeader": ["Content-Type"],
    "method": ["GET"],
    "maxAgeSeconds": 3600
  }
]
```

```sh
gsutil cors set path-to-cors-json-file gs://<bucket_name>...
gsutil cors get gs://<bucket_name>
```

## ãŠã‚ã‚Šã«

å½“åˆã¯ãƒ‰ãƒ¡ã‚¤ãƒ³ä»£ç¨‹åº¦ã®èµ¤å­—ã§ã‚‚è‰¯ã„ã¨æ€ã£ã¦ã„ã¾ã—ãŸã€‚ç¾åœ¨ã§ã¯æ¯æ—¥ã®ç²—é£Ÿ1æ¯ç¨‹åº¦ã®åºƒå‘Šåå…¥ç”±æ¥ã®åˆ©ç›Šã¯å‡ºã¦ãŠã‚Šã€é‹ç”¨ã‚³ã‚¹ãƒˆã‚’æŠ‘ãˆã‚‹ã“ã¨ã®ã§ãã‚‹ Firebase ã«æ„Ÿè¬ã—ãŸã„ã§ã™ã€‚
